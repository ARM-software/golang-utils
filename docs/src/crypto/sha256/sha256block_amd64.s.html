<!DOCTYPE html>
<!--
-- Copyright (C) 2020-2021 Arm Limited or its affiliates and Contributors. All rights reserved.
-- SPDX-License-Identifier: Apache-2.0
-->
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Source: sha256block_amd64.s in package crypto/sha256</title>
<link href="../../../css/light-v0.4.1.css" rel="stylesheet">
<script src="../../../jvs/golds-v0.4.1.js"></script>
<body onload="onPageLoad()"><div>

<pre id="header"><code><span class="title">Source File</span>
	sha256block_amd64.s

<span class="title">Belonging Package</span>
	<a href="../../../pkg/crypto/sha256.html">crypto/sha256</a>
</code></pre>

<pre class="line-numbers">
<span class="codeline" id="line-1"><code>// Copyright 2013 The Go Authors. All rights reserved.</code></span>
<span class="codeline" id="line-2"><code>// Use of this source code is governed by a BSD-style</code></span>
<span class="codeline" id="line-3"><code>// license that can be found in the LICENSE file.</code></span>
<span class="codeline" id="line-4"><code></code></span>
<span class="codeline" id="line-5"><code>#include "textflag.h"</code></span>
<span class="codeline" id="line-6"><code></code></span>
<span class="codeline" id="line-7"><code>// SHA256 block routine. See sha256block.go for Go equivalent.</code></span>
<span class="codeline" id="line-8"><code>//</code></span>
<span class="codeline" id="line-9"><code>// The algorithm is detailed in FIPS 180-4:</code></span>
<span class="codeline" id="line-10"><code>//</code></span>
<span class="codeline" id="line-11"><code>//  https://csrc.nist.gov/publications/fips/fips180-4/fips-180-4.pdf</code></span>
<span class="codeline" id="line-12"><code></code></span>
<span class="codeline" id="line-13"><code>// The avx2-version is described in an Intel White-Paper:</code></span>
<span class="codeline" id="line-14"><code>// "Fast SHA-256 Implementations on Intel Architecture Processors"</code></span>
<span class="codeline" id="line-15"><code>// To find it, surf to http://www.intel.com/p/en_US/embedded</code></span>
<span class="codeline" id="line-16"><code>// and search for that title.</code></span>
<span class="codeline" id="line-17"><code>// AVX2 version by Intel, same algorithm as code in Linux kernel:</code></span>
<span class="codeline" id="line-18"><code>// https://github.com/torvalds/linux/blob/master/arch/x86/crypto/sha256-avx2-asm.S</code></span>
<span class="codeline" id="line-19"><code>// by</code></span>
<span class="codeline" id="line-20"><code>//     James Guilford &lt;james.guilford@intel.com&gt;</code></span>
<span class="codeline" id="line-21"><code>//     Kirk Yap &lt;kirk.s.yap@intel.com&gt;</code></span>
<span class="codeline" id="line-22"><code>//     Tim Chen &lt;tim.c.chen@linux.intel.com&gt;</code></span>
<span class="codeline" id="line-23"><code></code></span>
<span class="codeline" id="line-24"><code>// Wt = Mt; for 0 &lt;= t &lt;= 15</code></span>
<span class="codeline" id="line-25"><code>// Wt = SIGMA1(Wt-2) + SIGMA0(Wt-15) + Wt-16; for 16 &lt;= t &lt;= 63</code></span>
<span class="codeline" id="line-26"><code>//</code></span>
<span class="codeline" id="line-27"><code>// a = H0</code></span>
<span class="codeline" id="line-28"><code>// b = H1</code></span>
<span class="codeline" id="line-29"><code>// c = H2</code></span>
<span class="codeline" id="line-30"><code>// d = H3</code></span>
<span class="codeline" id="line-31"><code>// e = H4</code></span>
<span class="codeline" id="line-32"><code>// f = H5</code></span>
<span class="codeline" id="line-33"><code>// g = H6</code></span>
<span class="codeline" id="line-34"><code>// h = H7</code></span>
<span class="codeline" id="line-35"><code>//</code></span>
<span class="codeline" id="line-36"><code>// for t = 0 to 63 {</code></span>
<span class="codeline" id="line-37"><code>//    T1 = h + BIGSIGMA1(e) + Ch(e,f,g) + Kt + Wt</code></span>
<span class="codeline" id="line-38"><code>//    T2 = BIGSIGMA0(a) + Maj(a,b,c)</code></span>
<span class="codeline" id="line-39"><code>//    h = g</code></span>
<span class="codeline" id="line-40"><code>//    g = f</code></span>
<span class="codeline" id="line-41"><code>//    f = e</code></span>
<span class="codeline" id="line-42"><code>//    e = d + T1</code></span>
<span class="codeline" id="line-43"><code>//    d = c</code></span>
<span class="codeline" id="line-44"><code>//    c = b</code></span>
<span class="codeline" id="line-45"><code>//    b = a</code></span>
<span class="codeline" id="line-46"><code>//    a = T1 + T2</code></span>
<span class="codeline" id="line-47"><code>// }</code></span>
<span class="codeline" id="line-48"><code>//</code></span>
<span class="codeline" id="line-49"><code>// H0 = a + H0</code></span>
<span class="codeline" id="line-50"><code>// H1 = b + H1</code></span>
<span class="codeline" id="line-51"><code>// H2 = c + H2</code></span>
<span class="codeline" id="line-52"><code>// H3 = d + H3</code></span>
<span class="codeline" id="line-53"><code>// H4 = e + H4</code></span>
<span class="codeline" id="line-54"><code>// H5 = f + H5</code></span>
<span class="codeline" id="line-55"><code>// H6 = g + H6</code></span>
<span class="codeline" id="line-56"><code>// H7 = h + H7</code></span>
<span class="codeline" id="line-57"><code></code></span>
<span class="codeline" id="line-58"><code>// Wt = Mt; for 0 &lt;= t &lt;= 15</code></span>
<span class="codeline" id="line-59"><code>#define MSGSCHEDULE0(index) \</code></span>
<span class="codeline" id="line-60"><code>	MOVL	(index*4)(SI), AX; \</code></span>
<span class="codeline" id="line-61"><code>	BSWAPL	AX; \</code></span>
<span class="codeline" id="line-62"><code>	MOVL	AX, (index*4)(BP)</code></span>
<span class="codeline" id="line-63"><code></code></span>
<span class="codeline" id="line-64"><code>// Wt = SIGMA1(Wt-2) + Wt-7 + SIGMA0(Wt-15) + Wt-16; for 16 &lt;= t &lt;= 63</code></span>
<span class="codeline" id="line-65"><code>//   SIGMA0(x) = ROTR(7,x) XOR ROTR(18,x) XOR SHR(3,x)</code></span>
<span class="codeline" id="line-66"><code>//   SIGMA1(x) = ROTR(17,x) XOR ROTR(19,x) XOR SHR(10,x)</code></span>
<span class="codeline" id="line-67"><code>#define MSGSCHEDULE1(index) \</code></span>
<span class="codeline" id="line-68"><code>	MOVL	((index-2)*4)(BP), AX; \</code></span>
<span class="codeline" id="line-69"><code>	MOVL	AX, CX; \</code></span>
<span class="codeline" id="line-70"><code>	RORL	$17, AX; \</code></span>
<span class="codeline" id="line-71"><code>	MOVL	CX, DX; \</code></span>
<span class="codeline" id="line-72"><code>	RORL	$19, CX; \</code></span>
<span class="codeline" id="line-73"><code>	SHRL	$10, DX; \</code></span>
<span class="codeline" id="line-74"><code>	MOVL	((index-15)*4)(BP), BX; \</code></span>
<span class="codeline" id="line-75"><code>	XORL	CX, AX; \</code></span>
<span class="codeline" id="line-76"><code>	MOVL	BX, CX; \</code></span>
<span class="codeline" id="line-77"><code>	XORL	DX, AX; \</code></span>
<span class="codeline" id="line-78"><code>	RORL	$7, BX; \</code></span>
<span class="codeline" id="line-79"><code>	MOVL	CX, DX; \</code></span>
<span class="codeline" id="line-80"><code>	SHRL	$3, DX; \</code></span>
<span class="codeline" id="line-81"><code>	RORL	$18, CX; \</code></span>
<span class="codeline" id="line-82"><code>	ADDL	((index-7)*4)(BP), AX; \</code></span>
<span class="codeline" id="line-83"><code>	XORL	CX, BX; \</code></span>
<span class="codeline" id="line-84"><code>	XORL	DX, BX; \</code></span>
<span class="codeline" id="line-85"><code>	ADDL	((index-16)*4)(BP), BX; \</code></span>
<span class="codeline" id="line-86"><code>	ADDL	BX, AX; \</code></span>
<span class="codeline" id="line-87"><code>	MOVL	AX, ((index)*4)(BP)</code></span>
<span class="codeline" id="line-88"><code></code></span>
<span class="codeline" id="line-89"><code>// Calculate T1 in AX - uses AX, CX and DX registers.</code></span>
<span class="codeline" id="line-90"><code>// h is also used as an accumulator. Wt is passed in AX.</code></span>
<span class="codeline" id="line-91"><code>//   T1 = h + BIGSIGMA1(e) + Ch(e, f, g) + Kt + Wt</code></span>
<span class="codeline" id="line-92"><code>//     BIGSIGMA1(x) = ROTR(6,x) XOR ROTR(11,x) XOR ROTR(25,x)</code></span>
<span class="codeline" id="line-93"><code>//     Ch(x, y, z) = (x AND y) XOR (NOT x AND z)</code></span>
<span class="codeline" id="line-94"><code>#define SHA256T1(const, e, f, g, h) \</code></span>
<span class="codeline" id="line-95"><code>	ADDL	AX, h; \</code></span>
<span class="codeline" id="line-96"><code>	MOVL	e, AX; \</code></span>
<span class="codeline" id="line-97"><code>	ADDL	$const, h; \</code></span>
<span class="codeline" id="line-98"><code>	MOVL	e, CX; \</code></span>
<span class="codeline" id="line-99"><code>	RORL	$6, AX; \</code></span>
<span class="codeline" id="line-100"><code>	MOVL	e, DX; \</code></span>
<span class="codeline" id="line-101"><code>	RORL	$11, CX; \</code></span>
<span class="codeline" id="line-102"><code>	XORL	CX, AX; \</code></span>
<span class="codeline" id="line-103"><code>	MOVL	e, CX; \</code></span>
<span class="codeline" id="line-104"><code>	RORL	$25, DX; \</code></span>
<span class="codeline" id="line-105"><code>	ANDL	f, CX; \</code></span>
<span class="codeline" id="line-106"><code>	XORL	AX, DX; \</code></span>
<span class="codeline" id="line-107"><code>	MOVL	e, AX; \</code></span>
<span class="codeline" id="line-108"><code>	NOTL	AX; \</code></span>
<span class="codeline" id="line-109"><code>	ADDL	DX, h; \</code></span>
<span class="codeline" id="line-110"><code>	ANDL	g, AX; \</code></span>
<span class="codeline" id="line-111"><code>	XORL	CX, AX; \</code></span>
<span class="codeline" id="line-112"><code>	ADDL	h, AX</code></span>
<span class="codeline" id="line-113"><code></code></span>
<span class="codeline" id="line-114"><code>// Calculate T2 in BX - uses BX, CX, DX and DI registers.</code></span>
<span class="codeline" id="line-115"><code>//   T2 = BIGSIGMA0(a) + Maj(a, b, c)</code></span>
<span class="codeline" id="line-116"><code>//     BIGSIGMA0(x) = ROTR(2,x) XOR ROTR(13,x) XOR ROTR(22,x)</code></span>
<span class="codeline" id="line-117"><code>//     Maj(x, y, z) = (x AND y) XOR (x AND z) XOR (y AND z)</code></span>
<span class="codeline" id="line-118"><code>#define SHA256T2(a, b, c) \</code></span>
<span class="codeline" id="line-119"><code>	MOVL	a, DI; \</code></span>
<span class="codeline" id="line-120"><code>	MOVL	c, BX; \</code></span>
<span class="codeline" id="line-121"><code>	RORL	$2, DI; \</code></span>
<span class="codeline" id="line-122"><code>	MOVL	a, DX; \</code></span>
<span class="codeline" id="line-123"><code>	ANDL	b, BX; \</code></span>
<span class="codeline" id="line-124"><code>	RORL	$13, DX; \</code></span>
<span class="codeline" id="line-125"><code>	MOVL	a, CX; \</code></span>
<span class="codeline" id="line-126"><code>	ANDL	c, CX; \</code></span>
<span class="codeline" id="line-127"><code>	XORL	DX, DI; \</code></span>
<span class="codeline" id="line-128"><code>	XORL	CX, BX; \</code></span>
<span class="codeline" id="line-129"><code>	MOVL	a, DX; \</code></span>
<span class="codeline" id="line-130"><code>	MOVL	b, CX; \</code></span>
<span class="codeline" id="line-131"><code>	RORL	$22, DX; \</code></span>
<span class="codeline" id="line-132"><code>	ANDL	a, CX; \</code></span>
<span class="codeline" id="line-133"><code>	XORL	CX, BX; \</code></span>
<span class="codeline" id="line-134"><code>	XORL	DX, DI; \</code></span>
<span class="codeline" id="line-135"><code>	ADDL	DI, BX</code></span>
<span class="codeline" id="line-136"><code></code></span>
<span class="codeline" id="line-137"><code>// Calculate T1 and T2, then e = d + T1 and a = T1 + T2.</code></span>
<span class="codeline" id="line-138"><code>// The values for e and a are stored in d and h, ready for rotation.</code></span>
<span class="codeline" id="line-139"><code>#define SHA256ROUND(index, const, a, b, c, d, e, f, g, h) \</code></span>
<span class="codeline" id="line-140"><code>	SHA256T1(const, e, f, g, h); \</code></span>
<span class="codeline" id="line-141"><code>	SHA256T2(a, b, c); \</code></span>
<span class="codeline" id="line-142"><code>	MOVL	BX, h; \</code></span>
<span class="codeline" id="line-143"><code>	ADDL	AX, d; \</code></span>
<span class="codeline" id="line-144"><code>	ADDL	AX, h</code></span>
<span class="codeline" id="line-145"><code></code></span>
<span class="codeline" id="line-146"><code>#define SHA256ROUND0(index, const, a, b, c, d, e, f, g, h) \</code></span>
<span class="codeline" id="line-147"><code>	MSGSCHEDULE0(index); \</code></span>
<span class="codeline" id="line-148"><code>	SHA256ROUND(index, const, a, b, c, d, e, f, g, h)</code></span>
<span class="codeline" id="line-149"><code></code></span>
<span class="codeline" id="line-150"><code>#define SHA256ROUND1(index, const, a, b, c, d, e, f, g, h) \</code></span>
<span class="codeline" id="line-151"><code>	MSGSCHEDULE1(index); \</code></span>
<span class="codeline" id="line-152"><code>	SHA256ROUND(index, const, a, b, c, d, e, f, g, h)</code></span>
<span class="codeline" id="line-153"><code></code></span>
<span class="codeline" id="line-154"><code></code></span>
<span class="codeline" id="line-155"><code>// Definitions for AVX2 version</code></span>
<span class="codeline" id="line-156"><code></code></span>
<span class="codeline" id="line-157"><code>// addm (mem), reg</code></span>
<span class="codeline" id="line-158"><code>// Add reg to mem using reg-mem add and store</code></span>
<span class="codeline" id="line-159"><code>#define addm(P1, P2) \</code></span>
<span class="codeline" id="line-160"><code>	ADDL P2, P1; \</code></span>
<span class="codeline" id="line-161"><code>	MOVL P1, P2</code></span>
<span class="codeline" id="line-162"><code></code></span>
<span class="codeline" id="line-163"><code>#define XDWORD0 Y4</code></span>
<span class="codeline" id="line-164"><code>#define XDWORD1 Y5</code></span>
<span class="codeline" id="line-165"><code>#define XDWORD2 Y6</code></span>
<span class="codeline" id="line-166"><code>#define XDWORD3 Y7</code></span>
<span class="codeline" id="line-167"><code></code></span>
<span class="codeline" id="line-168"><code>#define XWORD0 X4</code></span>
<span class="codeline" id="line-169"><code>#define XWORD1 X5</code></span>
<span class="codeline" id="line-170"><code>#define XWORD2 X6</code></span>
<span class="codeline" id="line-171"><code>#define XWORD3 X7</code></span>
<span class="codeline" id="line-172"><code></code></span>
<span class="codeline" id="line-173"><code>#define XTMP0 Y0</code></span>
<span class="codeline" id="line-174"><code>#define XTMP1 Y1</code></span>
<span class="codeline" id="line-175"><code>#define XTMP2 Y2</code></span>
<span class="codeline" id="line-176"><code>#define XTMP3 Y3</code></span>
<span class="codeline" id="line-177"><code>#define XTMP4 Y8</code></span>
<span class="codeline" id="line-178"><code>#define XTMP5 Y11</code></span>
<span class="codeline" id="line-179"><code></code></span>
<span class="codeline" id="line-180"><code>#define XFER  Y9</code></span>
<span class="codeline" id="line-181"><code></code></span>
<span class="codeline" id="line-182"><code>#define BYTE_FLIP_MASK 	Y13 // mask to convert LE -&gt; BE</code></span>
<span class="codeline" id="line-183"><code>#define X_BYTE_FLIP_MASK X13</code></span>
<span class="codeline" id="line-184"><code></code></span>
<span class="codeline" id="line-185"><code>#define NUM_BYTES DX</code></span>
<span class="codeline" id="line-186"><code>#define INP	DI</code></span>
<span class="codeline" id="line-187"><code></code></span>
<span class="codeline" id="line-188"><code>#define CTX SI // Beginning of digest in memory (a, b, c, ... , h)</code></span>
<span class="codeline" id="line-189"><code></code></span>
<span class="codeline" id="line-190"><code>#define a AX</code></span>
<span class="codeline" id="line-191"><code>#define b BX</code></span>
<span class="codeline" id="line-192"><code>#define c CX</code></span>
<span class="codeline" id="line-193"><code>#define d R8</code></span>
<span class="codeline" id="line-194"><code>#define e DX</code></span>
<span class="codeline" id="line-195"><code>#define f R9</code></span>
<span class="codeline" id="line-196"><code>#define g R10</code></span>
<span class="codeline" id="line-197"><code>#define h R11</code></span>
<span class="codeline" id="line-198"><code></code></span>
<span class="codeline" id="line-199"><code>#define old_h R11</code></span>
<span class="codeline" id="line-200"><code></code></span>
<span class="codeline" id="line-201"><code>#define TBL BP</code></span>
<span class="codeline" id="line-202"><code></code></span>
<span class="codeline" id="line-203"><code>#define SRND SI // SRND is same register as CTX</code></span>
<span class="codeline" id="line-204"><code></code></span>
<span class="codeline" id="line-205"><code>#define T1 R12</code></span>
<span class="codeline" id="line-206"><code></code></span>
<span class="codeline" id="line-207"><code>#define y0 R13</code></span>
<span class="codeline" id="line-208"><code>#define y1 R14</code></span>
<span class="codeline" id="line-209"><code>#define y2 R15</code></span>
<span class="codeline" id="line-210"><code>#define y3 DI</code></span>
<span class="codeline" id="line-211"><code></code></span>
<span class="codeline" id="line-212"><code>// Offsets</code></span>
<span class="codeline" id="line-213"><code>#define XFER_SIZE 2*64*4</code></span>
<span class="codeline" id="line-214"><code>#define INP_END_SIZE 8</code></span>
<span class="codeline" id="line-215"><code>#define INP_SIZE 8</code></span>
<span class="codeline" id="line-216"><code></code></span>
<span class="codeline" id="line-217"><code>#define _XFER 0</code></span>
<span class="codeline" id="line-218"><code>#define _INP_END _XFER + XFER_SIZE</code></span>
<span class="codeline" id="line-219"><code>#define _INP _INP_END + INP_END_SIZE</code></span>
<span class="codeline" id="line-220"><code>#define STACK_SIZE _INP + INP_SIZE</code></span>
<span class="codeline" id="line-221"><code></code></span>
<span class="codeline" id="line-222"><code>#define ROUND_AND_SCHED_N_0(disp, a, b, c, d, e, f, g, h, XDWORD0, XDWORD1, XDWORD2, XDWORD3) \</code></span>
<span class="codeline" id="line-223"><code>	;                                     \ // #############################  RND N + 0 ############################//</code></span>
<span class="codeline" id="line-224"><code>	MOVL     a, y3;                       \ // y3 = a					// MAJA</code></span>
<span class="codeline" id="line-225"><code>	RORXL    $25, e, y0;                  \ // y0 = e &gt;&gt; 25				// S1A</code></span>
<span class="codeline" id="line-226"><code>	RORXL    $11, e, y1;                  \ // y1 = e &gt;&gt; 11				// S1B</code></span>
<span class="codeline" id="line-227"><code>	;                                     \</code></span>
<span class="codeline" id="line-228"><code>	ADDL     (disp + 0*4)(SP)(SRND*1), h; \ // h = k + w + h        // disp = k + w</code></span>
<span class="codeline" id="line-229"><code>	ORL      c, y3;                       \ // y3 = a|c				// MAJA</code></span>
<span class="codeline" id="line-230"><code>	VPALIGNR $4, XDWORD2, XDWORD3, XTMP0; \ // XTMP0 = W[-7]</code></span>
<span class="codeline" id="line-231"><code>	MOVL     f, y2;                       \ // y2 = f				// CH</code></span>
<span class="codeline" id="line-232"><code>	RORXL    $13, a, T1;                  \ // T1 = a &gt;&gt; 13			// S0B</code></span>
<span class="codeline" id="line-233"><code>	;                                     \</code></span>
<span class="codeline" id="line-234"><code>	XORL     y1, y0;                      \ // y0 = (e&gt;&gt;25) ^ (e&gt;&gt;11)					// S1</code></span>
<span class="codeline" id="line-235"><code>	XORL     g, y2;                       \ // y2 = f^g                              	// CH</code></span>
<span class="codeline" id="line-236"><code>	VPADDD   XDWORD0, XTMP0, XTMP0;       \ // XTMP0 = W[-7] + W[-16]	// y1 = (e &gt;&gt; 6)	// S1</code></span>
<span class="codeline" id="line-237"><code>	RORXL    $6, e, y1;                   \ // y1 = (e &gt;&gt; 6)						// S1</code></span>
<span class="codeline" id="line-238"><code>	;                                     \</code></span>
<span class="codeline" id="line-239"><code>	ANDL     e, y2;                       \ // y2 = (f^g)&amp;e                         // CH</code></span>
<span class="codeline" id="line-240"><code>	XORL     y1, y0;                      \ // y0 = (e&gt;&gt;25) ^ (e&gt;&gt;11) ^ (e&gt;&gt;6)		// S1</code></span>
<span class="codeline" id="line-241"><code>	RORXL    $22, a, y1;                  \ // y1 = a &gt;&gt; 22							// S0A</code></span>
<span class="codeline" id="line-242"><code>	ADDL     h, d;                        \ // d = k + w + h + d                     	// --</code></span>
<span class="codeline" id="line-243"><code>	;                                     \</code></span>
<span class="codeline" id="line-244"><code>	ANDL     b, y3;                       \ // y3 = (a|c)&amp;b							// MAJA</code></span>
<span class="codeline" id="line-245"><code>	VPALIGNR $4, XDWORD0, XDWORD1, XTMP1; \ // XTMP1 = W[-15]</code></span>
<span class="codeline" id="line-246"><code>	XORL     T1, y1;                      \ // y1 = (a&gt;&gt;22) ^ (a&gt;&gt;13)				// S0</code></span>
<span class="codeline" id="line-247"><code>	RORXL    $2, a, T1;                   \ // T1 = (a &gt;&gt; 2)						// S0</code></span>
<span class="codeline" id="line-248"><code>	;                                     \</code></span>
<span class="codeline" id="line-249"><code>	XORL     g, y2;                       \ // y2 = CH = ((f^g)&amp;e)^g				// CH</code></span>
<span class="codeline" id="line-250"><code>	VPSRLD   $7, XTMP1, XTMP2;            \</code></span>
<span class="codeline" id="line-251"><code>	XORL     T1, y1;                      \ // y1 = (a&gt;&gt;22) ^ (a&gt;&gt;13) ^ (a&gt;&gt;2)		// S0</code></span>
<span class="codeline" id="line-252"><code>	MOVL     a, T1;                       \ // T1 = a								// MAJB</code></span>
<span class="codeline" id="line-253"><code>	ANDL     c, T1;                       \ // T1 = a&amp;c								// MAJB</code></span>
<span class="codeline" id="line-254"><code>	;                                     \</code></span>
<span class="codeline" id="line-255"><code>	ADDL     y0, y2;                      \ // y2 = S1 + CH							// --</code></span>
<span class="codeline" id="line-256"><code>	VPSLLD   $(32-7), XTMP1, XTMP3;       \</code></span>
<span class="codeline" id="line-257"><code>	ORL      T1, y3;                      \ // y3 = MAJ = (a|c)&amp;b)|(a&amp;c)			// MAJ</code></span>
<span class="codeline" id="line-258"><code>	ADDL     y1, h;                       \ // h = k + w + h + S0					// --</code></span>
<span class="codeline" id="line-259"><code>	;                                     \</code></span>
<span class="codeline" id="line-260"><code>	ADDL     y2, d;                       \ // d = k + w + h + d + S1 + CH = d + t1  // --</code></span>
<span class="codeline" id="line-261"><code>	VPOR     XTMP2, XTMP3, XTMP3;         \ // XTMP3 = W[-15] ror 7</code></span>
<span class="codeline" id="line-262"><code>	;                                     \</code></span>
<span class="codeline" id="line-263"><code>	VPSRLD   $18, XTMP1, XTMP2;           \</code></span>
<span class="codeline" id="line-264"><code>	ADDL     y2, h;                       \ // h = k + w + h + S0 + S1 + CH = t1 + S0// --</code></span>
<span class="codeline" id="line-265"><code>	ADDL     y3, h                        // h = t1 + S0 + MAJ                     // --</code></span>
<span class="codeline" id="line-266"><code></code></span>
<span class="codeline" id="line-267"><code>#define ROUND_AND_SCHED_N_1(disp, a, b, c, d, e, f, g, h, XDWORD0, XDWORD1, XDWORD2, XDWORD3) \</code></span>
<span class="codeline" id="line-268"><code>	;                                    \ // ################################### RND N + 1 ############################</code></span>
<span class="codeline" id="line-269"><code>	;                                    \</code></span>
<span class="codeline" id="line-270"><code>	MOVL    a, y3;                       \ // y3 = a                       // MAJA</code></span>
<span class="codeline" id="line-271"><code>	RORXL   $25, e, y0;                  \ // y0 = e &gt;&gt; 25					// S1A</code></span>
<span class="codeline" id="line-272"><code>	RORXL   $11, e, y1;                  \ // y1 = e &gt;&gt; 11					// S1B</code></span>
<span class="codeline" id="line-273"><code>	ADDL    (disp + 1*4)(SP)(SRND*1), h; \ // h = k + w + h         		// --</code></span>
<span class="codeline" id="line-274"><code>	ORL     c, y3;                       \ // y3 = a|c						// MAJA</code></span>
<span class="codeline" id="line-275"><code>	;                                    \</code></span>
<span class="codeline" id="line-276"><code>	VPSRLD  $3, XTMP1, XTMP4;            \ // XTMP4 = W[-15] &gt;&gt; 3</code></span>
<span class="codeline" id="line-277"><code>	MOVL    f, y2;                       \ // y2 = f						// CH</code></span>
<span class="codeline" id="line-278"><code>	RORXL   $13, a, T1;                  \ // T1 = a &gt;&gt; 13					// S0B</code></span>
<span class="codeline" id="line-279"><code>	XORL    y1, y0;                      \ // y0 = (e&gt;&gt;25) ^ (e&gt;&gt;11)		// S1</code></span>
<span class="codeline" id="line-280"><code>	XORL    g, y2;                       \ // y2 = f^g						// CH</code></span>
<span class="codeline" id="line-281"><code>	;                                    \</code></span>
<span class="codeline" id="line-282"><code>	RORXL   $6, e, y1;                   \ // y1 = (e &gt;&gt; 6)				// S1</code></span>
<span class="codeline" id="line-283"><code>	XORL    y1, y0;                      \ // y0 = (e&gt;&gt;25) ^ (e&gt;&gt;11) ^ (e&gt;&gt;6)	// S1</code></span>
<span class="codeline" id="line-284"><code>	RORXL   $22, a, y1;                  \ // y1 = a &gt;&gt; 22						// S0A</code></span>
<span class="codeline" id="line-285"><code>	ANDL    e, y2;                       \ // y2 = (f^g)&amp;e						// CH</code></span>
<span class="codeline" id="line-286"><code>	ADDL    h, d;                        \ // d = k + w + h + d				// --</code></span>
<span class="codeline" id="line-287"><code>	;                                    \</code></span>
<span class="codeline" id="line-288"><code>	VPSLLD  $(32-18), XTMP1, XTMP1;      \</code></span>
<span class="codeline" id="line-289"><code>	ANDL    b, y3;                       \ // y3 = (a|c)&amp;b					// MAJA</code></span>
<span class="codeline" id="line-290"><code>	XORL    T1, y1;                      \ // y1 = (a&gt;&gt;22) ^ (a&gt;&gt;13)		// S0</code></span>
<span class="codeline" id="line-291"><code>	;                                    \</code></span>
<span class="codeline" id="line-292"><code>	VPXOR   XTMP1, XTMP3, XTMP3;         \</code></span>
<span class="codeline" id="line-293"><code>	RORXL   $2, a, T1;                   \ // T1 = (a &gt;&gt; 2)				// S0</code></span>
<span class="codeline" id="line-294"><code>	XORL    g, y2;                       \ // y2 = CH = ((f^g)&amp;e)^g		// CH</code></span>
<span class="codeline" id="line-295"><code>	;                                    \</code></span>
<span class="codeline" id="line-296"><code>	VPXOR   XTMP2, XTMP3, XTMP3;         \ // XTMP3 = W[-15] ror 7 ^ W[-15] ror 18</code></span>
<span class="codeline" id="line-297"><code>	XORL    T1, y1;                      \ // y1 = (a&gt;&gt;22) ^ (a&gt;&gt;13) ^ (a&gt;&gt;2)		// S0</code></span>
<span class="codeline" id="line-298"><code>	MOVL    a, T1;                       \ // T1 = a						// MAJB</code></span>
<span class="codeline" id="line-299"><code>	ANDL    c, T1;                       \ // T1 = a&amp;c						// MAJB</code></span>
<span class="codeline" id="line-300"><code>	ADDL    y0, y2;                      \ // y2 = S1 + CH					// --</code></span>
<span class="codeline" id="line-301"><code>	;                                    \</code></span>
<span class="codeline" id="line-302"><code>	VPXOR   XTMP4, XTMP3, XTMP1;         \ // XTMP1 = s0</code></span>
<span class="codeline" id="line-303"><code>	VPSHUFD $0xFA, XDWORD3, XTMP2;       \ // XTMP2 = W[-2] {BBAA}</code></span>
<span class="codeline" id="line-304"><code>	ORL     T1, y3;                      \ // y3 = MAJ = (a|c)&amp;b)|(a&amp;c)             // MAJ</code></span>
<span class="codeline" id="line-305"><code>	ADDL    y1, h;                       \ // h = k + w + h + S0                    // --</code></span>
<span class="codeline" id="line-306"><code>	;                                    \</code></span>
<span class="codeline" id="line-307"><code>	VPADDD  XTMP1, XTMP0, XTMP0;         \ // XTMP0 = W[-16] + W[-7] + s0</code></span>
<span class="codeline" id="line-308"><code>	ADDL    y2, d;                       \ // d = k + w + h + d + S1 + CH = d + t1  // --</code></span>
<span class="codeline" id="line-309"><code>	ADDL    y2, h;                       \ // h = k + w + h + S0 + S1 + CH = t1 + S0// --</code></span>
<span class="codeline" id="line-310"><code>	ADDL    y3, h;                       \ // h = t1 + S0 + MAJ                     // --</code></span>
<span class="codeline" id="line-311"><code>	;                                    \</code></span>
<span class="codeline" id="line-312"><code>	VPSRLD  $10, XTMP2, XTMP4            // XTMP4 = W[-2] &gt;&gt; 10 {BBAA}</code></span>
<span class="codeline" id="line-313"><code></code></span>
<span class="codeline" id="line-314"><code>#define ROUND_AND_SCHED_N_2(disp, a, b, c, d, e, f, g, h, XDWORD0, XDWORD1, XDWORD2, XDWORD3) \</code></span>
<span class="codeline" id="line-315"><code>	;                                    \ // ################################### RND N + 2 ############################</code></span>
<span class="codeline" id="line-316"><code>	;                                    \</code></span>
<span class="codeline" id="line-317"><code>	MOVL    a, y3;                       \ // y3 = a							// MAJA</code></span>
<span class="codeline" id="line-318"><code>	RORXL   $25, e, y0;                  \ // y0 = e &gt;&gt; 25						// S1A</code></span>
<span class="codeline" id="line-319"><code>	ADDL    (disp + 2*4)(SP)(SRND*1), h; \ // h = k + w + h        			// --</code></span>
<span class="codeline" id="line-320"><code>	;                                    \</code></span>
<span class="codeline" id="line-321"><code>	VPSRLQ  $19, XTMP2, XTMP3;           \ // XTMP3 = W[-2] ror 19 {xBxA}</code></span>
<span class="codeline" id="line-322"><code>	RORXL   $11, e, y1;                  \ // y1 = e &gt;&gt; 11						// S1B</code></span>
<span class="codeline" id="line-323"><code>	ORL     c, y3;                       \ // y3 = a|c                         // MAJA</code></span>
<span class="codeline" id="line-324"><code>	MOVL    f, y2;                       \ // y2 = f                           // CH</code></span>
<span class="codeline" id="line-325"><code>	XORL    g, y2;                       \ // y2 = f^g                         // CH</code></span>
<span class="codeline" id="line-326"><code>	;                                    \</code></span>
<span class="codeline" id="line-327"><code>	RORXL   $13, a, T1;                  \ // T1 = a &gt;&gt; 13						// S0B</code></span>
<span class="codeline" id="line-328"><code>	XORL    y1, y0;                      \ // y0 = (e&gt;&gt;25) ^ (e&gt;&gt;11)			// S1</code></span>
<span class="codeline" id="line-329"><code>	VPSRLQ  $17, XTMP2, XTMP2;           \ // XTMP2 = W[-2] ror 17 {xBxA}</code></span>
<span class="codeline" id="line-330"><code>	ANDL    e, y2;                       \ // y2 = (f^g)&amp;e						// CH</code></span>
<span class="codeline" id="line-331"><code>	;                                    \</code></span>
<span class="codeline" id="line-332"><code>	RORXL   $6, e, y1;                   \ // y1 = (e &gt;&gt; 6)					// S1</code></span>
<span class="codeline" id="line-333"><code>	VPXOR   XTMP3, XTMP2, XTMP2;         \</code></span>
<span class="codeline" id="line-334"><code>	ADDL    h, d;                        \ // d = k + w + h + d				// --</code></span>
<span class="codeline" id="line-335"><code>	ANDL    b, y3;                       \ // y3 = (a|c)&amp;b						// MAJA</code></span>
<span class="codeline" id="line-336"><code>	;                                    \</code></span>
<span class="codeline" id="line-337"><code>	XORL    y1, y0;                      \ // y0 = (e&gt;&gt;25) ^ (e&gt;&gt;11) ^ (e&gt;&gt;6)	// S1</code></span>
<span class="codeline" id="line-338"><code>	RORXL   $22, a, y1;                  \ // y1 = a &gt;&gt; 22						// S0A</code></span>
<span class="codeline" id="line-339"><code>	VPXOR   XTMP2, XTMP4, XTMP4;         \ // XTMP4 = s1 {xBxA}</code></span>
<span class="codeline" id="line-340"><code>	XORL    g, y2;                       \ // y2 = CH = ((f^g)&amp;e)^g			// CH</code></span>
<span class="codeline" id="line-341"><code>	;                                    \</code></span>
<span class="codeline" id="line-342"><code>	VPSHUFB shuff_00BA&lt;&gt;(SB), XTMP4, XTMP4;\ // XTMP4 = s1 {00BA}</code></span>
<span class="codeline" id="line-343"><code>	;                                    \</code></span>
<span class="codeline" id="line-344"><code>	XORL    T1, y1;                      \ // y1 = (a&gt;&gt;22) ^ (a&gt;&gt;13)		// S0</code></span>
<span class="codeline" id="line-345"><code>	RORXL   $2, a, T1;                   \ // T1 = (a &gt;&gt; 2)				// S0</code></span>
<span class="codeline" id="line-346"><code>	VPADDD  XTMP4, XTMP0, XTMP0;         \ // XTMP0 = {..., ..., W[1], W[0]}</code></span>
<span class="codeline" id="line-347"><code>	;                                    \</code></span>
<span class="codeline" id="line-348"><code>	XORL    T1, y1;                      \ // y1 = (a&gt;&gt;22) ^ (a&gt;&gt;13) ^ (a&gt;&gt;2)	// S0</code></span>
<span class="codeline" id="line-349"><code>	MOVL    a, T1;                       \ // T1 = a                                // MAJB</code></span>
<span class="codeline" id="line-350"><code>	ANDL    c, T1;                       \ // T1 = a&amp;c                              // MAJB</code></span>
<span class="codeline" id="line-351"><code>	ADDL    y0, y2;                      \ // y2 = S1 + CH                          // --</code></span>
<span class="codeline" id="line-352"><code>	VPSHUFD $80, XTMP0, XTMP2;           \ // XTMP2 = W[-2] {DDCC}</code></span>
<span class="codeline" id="line-353"><code>	;                                    \</code></span>
<span class="codeline" id="line-354"><code>	ORL     T1, y3;                      \ // y3 = MAJ = (a|c)&amp;b)|(a&amp;c)             // MAJ</code></span>
<span class="codeline" id="line-355"><code>	ADDL    y1, h;                       \ // h = k + w + h + S0                    // --</code></span>
<span class="codeline" id="line-356"><code>	ADDL    y2, d;                       \ // d = k + w + h + d + S1 + CH = d + t1  // --</code></span>
<span class="codeline" id="line-357"><code>	ADDL    y2, h;                       \ // h = k + w + h + S0 + S1 + CH = t1 + S0// --</code></span>
<span class="codeline" id="line-358"><code>	;                                    \</code></span>
<span class="codeline" id="line-359"><code>	ADDL    y3, h                        // h = t1 + S0 + MAJ                     // --</code></span>
<span class="codeline" id="line-360"><code></code></span>
<span class="codeline" id="line-361"><code>#define ROUND_AND_SCHED_N_3(disp, a, b, c, d, e, f, g, h, XDWORD0, XDWORD1, XDWORD2, XDWORD3) \</code></span>
<span class="codeline" id="line-362"><code>	;                                    \ // ################################### RND N + 3 ############################</code></span>
<span class="codeline" id="line-363"><code>	;                                    \</code></span>
<span class="codeline" id="line-364"><code>	MOVL    a, y3;                       \ // y3 = a						// MAJA</code></span>
<span class="codeline" id="line-365"><code>	RORXL   $25, e, y0;                  \ // y0 = e &gt;&gt; 25					// S1A</code></span>
<span class="codeline" id="line-366"><code>	RORXL   $11, e, y1;                  \ // y1 = e &gt;&gt; 11					// S1B</code></span>
<span class="codeline" id="line-367"><code>	ADDL    (disp + 3*4)(SP)(SRND*1), h; \ // h = k + w + h				// --</code></span>
<span class="codeline" id="line-368"><code>	ORL     c, y3;                       \ // y3 = a|c                     // MAJA</code></span>
<span class="codeline" id="line-369"><code>	;                                    \</code></span>
<span class="codeline" id="line-370"><code>	VPSRLD  $10, XTMP2, XTMP5;           \ // XTMP5 = W[-2] &gt;&gt; 10 {DDCC}</code></span>
<span class="codeline" id="line-371"><code>	MOVL    f, y2;                       \ // y2 = f						// CH</code></span>
<span class="codeline" id="line-372"><code>	RORXL   $13, a, T1;                  \ // T1 = a &gt;&gt; 13					// S0B</code></span>
<span class="codeline" id="line-373"><code>	XORL    y1, y0;                      \ // y0 = (e&gt;&gt;25) ^ (e&gt;&gt;11)		// S1</code></span>
<span class="codeline" id="line-374"><code>	XORL    g, y2;                       \ // y2 = f^g						// CH</code></span>
<span class="codeline" id="line-375"><code>	;                                    \</code></span>
<span class="codeline" id="line-376"><code>	VPSRLQ  $19, XTMP2, XTMP3;           \ // XTMP3 = W[-2] ror 19 {xDxC}</code></span>
<span class="codeline" id="line-377"><code>	RORXL   $6, e, y1;                   \ // y1 = (e &gt;&gt; 6)				// S1</code></span>
<span class="codeline" id="line-378"><code>	ANDL    e, y2;                       \ // y2 = (f^g)&amp;e					// CH</code></span>
<span class="codeline" id="line-379"><code>	ADDL    h, d;                        \ // d = k + w + h + d			// --</code></span>
<span class="codeline" id="line-380"><code>	ANDL    b, y3;                       \ // y3 = (a|c)&amp;b					// MAJA</code></span>
<span class="codeline" id="line-381"><code>	;                                    \</code></span>
<span class="codeline" id="line-382"><code>	VPSRLQ  $17, XTMP2, XTMP2;           \ // XTMP2 = W[-2] ror 17 {xDxC}</code></span>
<span class="codeline" id="line-383"><code>	XORL    y1, y0;                      \ // y0 = (e&gt;&gt;25) ^ (e&gt;&gt;11) ^ (e&gt;&gt;6)	// S1</code></span>
<span class="codeline" id="line-384"><code>	XORL    g, y2;                       \ // y2 = CH = ((f^g)&amp;e)^g			// CH</code></span>
<span class="codeline" id="line-385"><code>	;                                    \</code></span>
<span class="codeline" id="line-386"><code>	VPXOR   XTMP3, XTMP2, XTMP2;         \</code></span>
<span class="codeline" id="line-387"><code>	RORXL   $22, a, y1;                  \ // y1 = a &gt;&gt; 22					// S0A</code></span>
<span class="codeline" id="line-388"><code>	ADDL    y0, y2;                      \ // y2 = S1 + CH					// --</code></span>
<span class="codeline" id="line-389"><code>	;                                    \</code></span>
<span class="codeline" id="line-390"><code>	VPXOR   XTMP2, XTMP5, XTMP5;         \ // XTMP5 = s1 {xDxC}</code></span>
<span class="codeline" id="line-391"><code>	XORL    T1, y1;                      \ // y1 = (a&gt;&gt;22) ^ (a&gt;&gt;13)		// S0</code></span>
<span class="codeline" id="line-392"><code>	ADDL    y2, d;                       \ // d = k + w + h + d + S1 + CH = d + t1  // --</code></span>
<span class="codeline" id="line-393"><code>	;                                    \</code></span>
<span class="codeline" id="line-394"><code>	RORXL   $2, a, T1;                   \ // T1 = (a &gt;&gt; 2)				// S0</code></span>
<span class="codeline" id="line-395"><code>	;                                    \</code></span>
<span class="codeline" id="line-396"><code>	VPSHUFB shuff_DC00&lt;&gt;(SB), XTMP5, XTMP5;\ // XTMP5 = s1 {DC00}</code></span>
<span class="codeline" id="line-397"><code>	;                                    \</code></span>
<span class="codeline" id="line-398"><code>	VPADDD  XTMP0, XTMP5, XDWORD0;       \ // XDWORD0 = {W[3], W[2], W[1], W[0]}</code></span>
<span class="codeline" id="line-399"><code>	XORL    T1, y1;                      \ // y1 = (a&gt;&gt;22) ^ (a&gt;&gt;13) ^ (a&gt;&gt;2)	// S0</code></span>
<span class="codeline" id="line-400"><code>	MOVL    a, T1;                       \ // T1 = a							// MAJB</code></span>
<span class="codeline" id="line-401"><code>	ANDL    c, T1;                       \ // T1 = a&amp;c							// MAJB</code></span>
<span class="codeline" id="line-402"><code>	ORL     T1, y3;                      \ // y3 = MAJ = (a|c)&amp;b)|(a&amp;c)		// MAJ</code></span>
<span class="codeline" id="line-403"><code>	;                                    \</code></span>
<span class="codeline" id="line-404"><code>	ADDL    y1, h;                       \ // h = k + w + h + S0				// --</code></span>
<span class="codeline" id="line-405"><code>	ADDL    y2, h;                       \ // h = k + w + h + S0 + S1 + CH = t1 + S0// --</code></span>
<span class="codeline" id="line-406"><code>	ADDL    y3, h                        // h = t1 + S0 + MAJ				// --</code></span>
<span class="codeline" id="line-407"><code></code></span>
<span class="codeline" id="line-408"><code>#define DO_ROUND_N_0(disp, a, b, c, d, e, f, g, h, old_h) \</code></span>
<span class="codeline" id="line-409"><code>	;                                  \ // ################################### RND N + 0 ###########################</code></span>
<span class="codeline" id="line-410"><code>	MOVL  f, y2;                       \ // y2 = f					// CH</code></span>
<span class="codeline" id="line-411"><code>	RORXL $25, e, y0;                  \ // y0 = e &gt;&gt; 25				// S1A</code></span>
<span class="codeline" id="line-412"><code>	RORXL $11, e, y1;                  \ // y1 = e &gt;&gt; 11				// S1B</code></span>
<span class="codeline" id="line-413"><code>	XORL  g, y2;                       \ // y2 = f^g					// CH</code></span>
<span class="codeline" id="line-414"><code>	;                                  \</code></span>
<span class="codeline" id="line-415"><code>	XORL  y1, y0;                      \ // y0 = (e&gt;&gt;25) ^ (e&gt;&gt;11)	// S1</code></span>
<span class="codeline" id="line-416"><code>	RORXL $6, e, y1;                   \ // y1 = (e &gt;&gt; 6)			// S1</code></span>
<span class="codeline" id="line-417"><code>	ANDL  e, y2;                       \ // y2 = (f^g)&amp;e				// CH</code></span>
<span class="codeline" id="line-418"><code>	;                                  \</code></span>
<span class="codeline" id="line-419"><code>	XORL  y1, y0;                      \ // y0 = (e&gt;&gt;25) ^ (e&gt;&gt;11) ^ (e&gt;&gt;6)	// S1</code></span>
<span class="codeline" id="line-420"><code>	RORXL $13, a, T1;                  \ // T1 = a &gt;&gt; 13						// S0B</code></span>
<span class="codeline" id="line-421"><code>	XORL  g, y2;                       \ // y2 = CH = ((f^g)&amp;e)^g			// CH</code></span>
<span class="codeline" id="line-422"><code>	RORXL $22, a, y1;                  \ // y1 = a &gt;&gt; 22						// S0A</code></span>
<span class="codeline" id="line-423"><code>	MOVL  a, y3;                       \ // y3 = a							// MAJA</code></span>
<span class="codeline" id="line-424"><code>	;                                  \</code></span>
<span class="codeline" id="line-425"><code>	XORL  T1, y1;                      \ // y1 = (a&gt;&gt;22) ^ (a&gt;&gt;13)			// S0</code></span>
<span class="codeline" id="line-426"><code>	RORXL $2, a, T1;                   \ // T1 = (a &gt;&gt; 2)					// S0</code></span>
<span class="codeline" id="line-427"><code>	ADDL  (disp + 0*4)(SP)(SRND*1), h; \ // h = k + w + h // --</code></span>
<span class="codeline" id="line-428"><code>	ORL   c, y3;                       \ // y3 = a|c							// MAJA</code></span>
<span class="codeline" id="line-429"><code>	;                                  \</code></span>
<span class="codeline" id="line-430"><code>	XORL  T1, y1;                      \ // y1 = (a&gt;&gt;22) ^ (a&gt;&gt;13) ^ (a&gt;&gt;2)	// S0</code></span>
<span class="codeline" id="line-431"><code>	MOVL  a, T1;                       \ // T1 = a							// MAJB</code></span>
<span class="codeline" id="line-432"><code>	ANDL  b, y3;                       \ // y3 = (a|c)&amp;b						// MAJA</code></span>
<span class="codeline" id="line-433"><code>	ANDL  c, T1;                       \ // T1 = a&amp;c							// MAJB</code></span>
<span class="codeline" id="line-434"><code>	ADDL  y0, y2;                      \ // y2 = S1 + CH						// --</code></span>
<span class="codeline" id="line-435"><code>	;                                  \</code></span>
<span class="codeline" id="line-436"><code>	ADDL  h, d;                        \ // d = k + w + h + d					// --</code></span>
<span class="codeline" id="line-437"><code>	ORL   T1, y3;                      \ // y3 = MAJ = (a|c)&amp;b)|(a&amp;c)			// MAJ</code></span>
<span class="codeline" id="line-438"><code>	ADDL  y1, h;                       \ // h = k + w + h + S0					// --</code></span>
<span class="codeline" id="line-439"><code>	ADDL  y2, d                        // d = k + w + h + d + S1 + CH = d + t1	// --</code></span>
<span class="codeline" id="line-440"><code></code></span>
<span class="codeline" id="line-441"><code>#define DO_ROUND_N_1(disp, a, b, c, d, e, f, g, h, old_h) \</code></span>
<span class="codeline" id="line-442"><code>	;                                  \ // ################################### RND N + 1 ###########################</code></span>
<span class="codeline" id="line-443"><code>	ADDL  y2, old_h;                   \ // h = k + w + h + S0 + S1 + CH = t1 + S0 // --</code></span>
<span class="codeline" id="line-444"><code>	MOVL  f, y2;                       \ // y2 = f                                // CH</code></span>
<span class="codeline" id="line-445"><code>	RORXL $25, e, y0;                  \ // y0 = e &gt;&gt; 25				// S1A</code></span>
<span class="codeline" id="line-446"><code>	RORXL $11, e, y1;                  \ // y1 = e &gt;&gt; 11				// S1B</code></span>
<span class="codeline" id="line-447"><code>	XORL  g, y2;                       \ // y2 = f^g                             // CH</code></span>
<span class="codeline" id="line-448"><code>	;                                  \</code></span>
<span class="codeline" id="line-449"><code>	XORL  y1, y0;                      \ // y0 = (e&gt;&gt;25) ^ (e&gt;&gt;11)				// S1</code></span>
<span class="codeline" id="line-450"><code>	RORXL $6, e, y1;                   \ // y1 = (e &gt;&gt; 6)						// S1</code></span>
<span class="codeline" id="line-451"><code>	ANDL  e, y2;                       \ // y2 = (f^g)&amp;e                         // CH</code></span>
<span class="codeline" id="line-452"><code>	ADDL  y3, old_h;                   \ // h = t1 + S0 + MAJ                    // --</code></span>
<span class="codeline" id="line-453"><code>	;                                  \</code></span>
<span class="codeline" id="line-454"><code>	XORL  y1, y0;                      \ // y0 = (e&gt;&gt;25) ^ (e&gt;&gt;11) ^ (e&gt;&gt;6)		// S1</code></span>
<span class="codeline" id="line-455"><code>	RORXL $13, a, T1;                  \ // T1 = a &gt;&gt; 13							// S0B</code></span>
<span class="codeline" id="line-456"><code>	XORL  g, y2;                       \ // y2 = CH = ((f^g)&amp;e)^g                // CH</code></span>
<span class="codeline" id="line-457"><code>	RORXL $22, a, y1;                  \ // y1 = a &gt;&gt; 22							// S0A</code></span>
<span class="codeline" id="line-458"><code>	MOVL  a, y3;                       \ // y3 = a                               // MAJA</code></span>
<span class="codeline" id="line-459"><code>	;                                  \</code></span>
<span class="codeline" id="line-460"><code>	XORL  T1, y1;                      \ // y1 = (a&gt;&gt;22) ^ (a&gt;&gt;13)				// S0</code></span>
<span class="codeline" id="line-461"><code>	RORXL $2, a, T1;                   \ // T1 = (a &gt;&gt; 2)						// S0</code></span>
<span class="codeline" id="line-462"><code>	ADDL  (disp + 1*4)(SP)(SRND*1), h; \ // h = k + w + h // --</code></span>
<span class="codeline" id="line-463"><code>	ORL   c, y3;                       \ // y3 = a|c                             // MAJA</code></span>
<span class="codeline" id="line-464"><code>	;                                  \</code></span>
<span class="codeline" id="line-465"><code>	XORL  T1, y1;                      \ // y1 = (a&gt;&gt;22) ^ (a&gt;&gt;13) ^ (a&gt;&gt;2)		// S0</code></span>
<span class="codeline" id="line-466"><code>	MOVL  a, T1;                       \ // T1 = a                               // MAJB</code></span>
<span class="codeline" id="line-467"><code>	ANDL  b, y3;                       \ // y3 = (a|c)&amp;b                         // MAJA</code></span>
<span class="codeline" id="line-468"><code>	ANDL  c, T1;                       \ // T1 = a&amp;c                             // MAJB</code></span>
<span class="codeline" id="line-469"><code>	ADDL  y0, y2;                      \ // y2 = S1 + CH                         // --</code></span>
<span class="codeline" id="line-470"><code>	;                                  \</code></span>
<span class="codeline" id="line-471"><code>	ADDL  h, d;                        \ // d = k + w + h + d                    // --</code></span>
<span class="codeline" id="line-472"><code>	ORL   T1, y3;                      \ // y3 = MAJ = (a|c)&amp;b)|(a&amp;c)            // MAJ</code></span>
<span class="codeline" id="line-473"><code>	ADDL  y1, h;                       \ // h = k + w + h + S0                   // --</code></span>
<span class="codeline" id="line-474"><code>	;                                  \</code></span>
<span class="codeline" id="line-475"><code>	ADDL  y2, d                        // d = k + w + h + d + S1 + CH = d + t1 // --</code></span>
<span class="codeline" id="line-476"><code></code></span>
<span class="codeline" id="line-477"><code>#define DO_ROUND_N_2(disp, a, b, c, d, e, f, g, h, old_h) \</code></span>
<span class="codeline" id="line-478"><code>	;                                  \ // ################################### RND N + 2 ##############################</code></span>
<span class="codeline" id="line-479"><code>	ADDL  y2, old_h;                   \ // h = k + w + h + S0 + S1 + CH = t1 + S0// --</code></span>
<span class="codeline" id="line-480"><code>	MOVL  f, y2;                       \ // y2 = f								// CH</code></span>
<span class="codeline" id="line-481"><code>	RORXL $25, e, y0;                  \ // y0 = e &gt;&gt; 25							// S1A</code></span>
<span class="codeline" id="line-482"><code>	RORXL $11, e, y1;                  \ // y1 = e &gt;&gt; 11							// S1B</code></span>
<span class="codeline" id="line-483"><code>	XORL  g, y2;                       \ // y2 = f^g								// CH</code></span>
<span class="codeline" id="line-484"><code>	;                                  \</code></span>
<span class="codeline" id="line-485"><code>	XORL  y1, y0;                      \ // y0 = (e&gt;&gt;25) ^ (e&gt;&gt;11)				// S1</code></span>
<span class="codeline" id="line-486"><code>	RORXL $6, e, y1;                   \ // y1 = (e &gt;&gt; 6)						// S1</code></span>
<span class="codeline" id="line-487"><code>	ANDL  e, y2;                       \ // y2 = (f^g)&amp;e							// CH</code></span>
<span class="codeline" id="line-488"><code>	ADDL  y3, old_h;                   \ // h = t1 + S0 + MAJ					// --</code></span>
<span class="codeline" id="line-489"><code>	;                                  \</code></span>
<span class="codeline" id="line-490"><code>	XORL  y1, y0;                      \ // y0 = (e&gt;&gt;25) ^ (e&gt;&gt;11) ^ (e&gt;&gt;6)		// S1</code></span>
<span class="codeline" id="line-491"><code>	RORXL $13, a, T1;                  \ // T1 = a &gt;&gt; 13							// S0B</code></span>
<span class="codeline" id="line-492"><code>	XORL  g, y2;                       \ // y2 = CH = ((f^g)&amp;e)^g                // CH</code></span>
<span class="codeline" id="line-493"><code>	RORXL $22, a, y1;                  \ // y1 = a &gt;&gt; 22							// S0A</code></span>
<span class="codeline" id="line-494"><code>	MOVL  a, y3;                       \ // y3 = a								// MAJA</code></span>
<span class="codeline" id="line-495"><code>	;                                  \</code></span>
<span class="codeline" id="line-496"><code>	XORL  T1, y1;                      \ // y1 = (a&gt;&gt;22) ^ (a&gt;&gt;13)				// S0</code></span>
<span class="codeline" id="line-497"><code>	RORXL $2, a, T1;                   \ // T1 = (a &gt;&gt; 2)						// S0</code></span>
<span class="codeline" id="line-498"><code>	ADDL  (disp + 2*4)(SP)(SRND*1), h; \ // h = k + w + h 	// --</code></span>
<span class="codeline" id="line-499"><code>	ORL   c, y3;                       \ // y3 = a|c								// MAJA</code></span>
<span class="codeline" id="line-500"><code>	;                                  \</code></span>
<span class="codeline" id="line-501"><code>	XORL  T1, y1;                      \ // y1 = (a&gt;&gt;22) ^ (a&gt;&gt;13) ^ (a&gt;&gt;2)		// S0</code></span>
<span class="codeline" id="line-502"><code>	MOVL  a, T1;                       \ // T1 = a								// MAJB</code></span>
<span class="codeline" id="line-503"><code>	ANDL  b, y3;                       \ // y3 = (a|c)&amp;b							// MAJA</code></span>
<span class="codeline" id="line-504"><code>	ANDL  c, T1;                       \ // T1 = a&amp;c								// MAJB</code></span>
<span class="codeline" id="line-505"><code>	ADDL  y0, y2;                      \ // y2 = S1 + CH							// --</code></span>
<span class="codeline" id="line-506"><code>	;                                  \</code></span>
<span class="codeline" id="line-507"><code>	ADDL  h, d;                        \ // d = k + w + h + d					// --</code></span>
<span class="codeline" id="line-508"><code>	ORL   T1, y3;                      \ // y3 = MAJ = (a|c)&amp;b)|(a&amp;c)			// MAJ</code></span>
<span class="codeline" id="line-509"><code>	ADDL  y1, h;                       \ // h = k + w + h + S0					// --</code></span>
<span class="codeline" id="line-510"><code>	;                                  \</code></span>
<span class="codeline" id="line-511"><code>	ADDL  y2, d                        // d = k + w + h + d + S1 + CH = d + t1 // --</code></span>
<span class="codeline" id="line-512"><code></code></span>
<span class="codeline" id="line-513"><code>#define DO_ROUND_N_3(disp, a, b, c, d, e, f, g, h, old_h) \</code></span>
<span class="codeline" id="line-514"><code>	;                                  \ // ################################### RND N + 3 ###########################</code></span>
<span class="codeline" id="line-515"><code>	ADDL  y2, old_h;                   \ // h = k + w + h + S0 + S1 + CH = t1 + S0// --</code></span>
<span class="codeline" id="line-516"><code>	MOVL  f, y2;                       \ // y2 = f								// CH</code></span>
<span class="codeline" id="line-517"><code>	RORXL $25, e, y0;                  \ // y0 = e &gt;&gt; 25							// S1A</code></span>
<span class="codeline" id="line-518"><code>	RORXL $11, e, y1;                  \ // y1 = e &gt;&gt; 11							// S1B</code></span>
<span class="codeline" id="line-519"><code>	XORL  g, y2;                       \ // y2 = f^g								// CH</code></span>
<span class="codeline" id="line-520"><code>	;                                  \</code></span>
<span class="codeline" id="line-521"><code>	XORL  y1, y0;                      \ // y0 = (e&gt;&gt;25) ^ (e&gt;&gt;11)				// S1</code></span>
<span class="codeline" id="line-522"><code>	RORXL $6, e, y1;                   \ // y1 = (e &gt;&gt; 6)						// S1</code></span>
<span class="codeline" id="line-523"><code>	ANDL  e, y2;                       \ // y2 = (f^g)&amp;e							// CH</code></span>
<span class="codeline" id="line-524"><code>	ADDL  y3, old_h;                   \ // h = t1 + S0 + MAJ					// --</code></span>
<span class="codeline" id="line-525"><code>	;                                  \</code></span>
<span class="codeline" id="line-526"><code>	XORL  y1, y0;                      \ // y0 = (e&gt;&gt;25) ^ (e&gt;&gt;11) ^ (e&gt;&gt;6)		// S1</code></span>
<span class="codeline" id="line-527"><code>	RORXL $13, a, T1;                  \ // T1 = a &gt;&gt; 13							// S0B</code></span>
<span class="codeline" id="line-528"><code>	XORL  g, y2;                       \ // y2 = CH = ((f^g)&amp;e)^g				// CH</code></span>
<span class="codeline" id="line-529"><code>	RORXL $22, a, y1;                  \ // y1 = a &gt;&gt; 22							// S0A</code></span>
<span class="codeline" id="line-530"><code>	MOVL  a, y3;                       \ // y3 = a								// MAJA</code></span>
<span class="codeline" id="line-531"><code>	;                                  \</code></span>
<span class="codeline" id="line-532"><code>	XORL  T1, y1;                      \ // y1 = (a&gt;&gt;22) ^ (a&gt;&gt;13)				// S0</code></span>
<span class="codeline" id="line-533"><code>	RORXL $2, a, T1;                   \ // T1 = (a &gt;&gt; 2)						// S0</code></span>
<span class="codeline" id="line-534"><code>	ADDL  (disp + 3*4)(SP)(SRND*1), h; \ // h = k + w + h 	// --</code></span>
<span class="codeline" id="line-535"><code>	ORL   c, y3;                       \ // y3 = a|c								// MAJA</code></span>
<span class="codeline" id="line-536"><code>	;                                  \</code></span>
<span class="codeline" id="line-537"><code>	XORL  T1, y1;                      \ // y1 = (a&gt;&gt;22) ^ (a&gt;&gt;13) ^ (a&gt;&gt;2)		// S0</code></span>
<span class="codeline" id="line-538"><code>	MOVL  a, T1;                       \ // T1 = a								// MAJB</code></span>
<span class="codeline" id="line-539"><code>	ANDL  b, y3;                       \ // y3 = (a|c)&amp;b							// MAJA</code></span>
<span class="codeline" id="line-540"><code>	ANDL  c, T1;                       \ // T1 = a&amp;c								// MAJB</code></span>
<span class="codeline" id="line-541"><code>	ADDL  y0, y2;                      \ // y2 = S1 + CH							// --</code></span>
<span class="codeline" id="line-542"><code>	;                                  \</code></span>
<span class="codeline" id="line-543"><code>	ADDL  h, d;                        \ // d = k + w + h + d					// --</code></span>
<span class="codeline" id="line-544"><code>	ORL   T1, y3;                      \ // y3 = MAJ = (a|c)&amp;b)|(a&amp;c)			// MAJ</code></span>
<span class="codeline" id="line-545"><code>	ADDL  y1, h;                       \ // h = k + w + h + S0					// --</code></span>
<span class="codeline" id="line-546"><code>	;                                  \</code></span>
<span class="codeline" id="line-547"><code>	ADDL  y2, d;                       \ // d = k + w + h + d + S1 + CH = d + t1	// --</code></span>
<span class="codeline" id="line-548"><code>	;                                  \</code></span>
<span class="codeline" id="line-549"><code>	ADDL  y2, h;                       \ // h = k + w + h + S0 + S1 + CH = t1 + S0// --</code></span>
<span class="codeline" id="line-550"><code>	;                                  \</code></span>
<span class="codeline" id="line-551"><code>	ADDL  y3, h                        // h = t1 + S0 + MAJ					// --</code></span>
<span class="codeline" id="line-552"><code></code></span>
<span class="codeline" id="line-553"><code>TEXT block(SB), 0, $536-32</code></span>
<span class="codeline" id="line-554"><code>	CMPB useAVX2(SB), $1</code></span>
<span class="codeline" id="line-555"><code>	JE   avx2</code></span>
<span class="codeline" id="line-556"><code></code></span>
<span class="codeline" id="line-557"><code>	MOVQ p_base+8(FP), SI</code></span>
<span class="codeline" id="line-558"><code>	MOVQ p_len+16(FP), DX</code></span>
<span class="codeline" id="line-559"><code>	SHRQ $6, DX</code></span>
<span class="codeline" id="line-560"><code>	SHLQ $6, DX</code></span>
<span class="codeline" id="line-561"><code></code></span>
<span class="codeline" id="line-562"><code>	LEAQ (SI)(DX*1), DI</code></span>
<span class="codeline" id="line-563"><code>	MOVQ DI, 256(SP)</code></span>
<span class="codeline" id="line-564"><code>	CMPQ SI, DI</code></span>
<span class="codeline" id="line-565"><code>	JEQ  end</code></span>
<span class="codeline" id="line-566"><code></code></span>
<span class="codeline" id="line-567"><code>	MOVQ dig+0(FP), BP</code></span>
<span class="codeline" id="line-568"><code>	MOVL (0*4)(BP), R8  // a = H0</code></span>
<span class="codeline" id="line-569"><code>	MOVL (1*4)(BP), R9  // b = H1</code></span>
<span class="codeline" id="line-570"><code>	MOVL (2*4)(BP), R10 // c = H2</code></span>
<span class="codeline" id="line-571"><code>	MOVL (3*4)(BP), R11 // d = H3</code></span>
<span class="codeline" id="line-572"><code>	MOVL (4*4)(BP), R12 // e = H4</code></span>
<span class="codeline" id="line-573"><code>	MOVL (5*4)(BP), R13 // f = H5</code></span>
<span class="codeline" id="line-574"><code>	MOVL (6*4)(BP), R14 // g = H6</code></span>
<span class="codeline" id="line-575"><code>	MOVL (7*4)(BP), R15 // h = H7</code></span>
<span class="codeline" id="line-576"><code></code></span>
<span class="codeline" id="line-577"><code>loop:</code></span>
<span class="codeline" id="line-578"><code>	MOVQ SP, BP</code></span>
<span class="codeline" id="line-579"><code></code></span>
<span class="codeline" id="line-580"><code>	SHA256ROUND0(0, 0x428a2f98, R8, R9, R10, R11, R12, R13, R14, R15)</code></span>
<span class="codeline" id="line-581"><code>	SHA256ROUND0(1, 0x71374491, R15, R8, R9, R10, R11, R12, R13, R14)</code></span>
<span class="codeline" id="line-582"><code>	SHA256ROUND0(2, 0xb5c0fbcf, R14, R15, R8, R9, R10, R11, R12, R13)</code></span>
<span class="codeline" id="line-583"><code>	SHA256ROUND0(3, 0xe9b5dba5, R13, R14, R15, R8, R9, R10, R11, R12)</code></span>
<span class="codeline" id="line-584"><code>	SHA256ROUND0(4, 0x3956c25b, R12, R13, R14, R15, R8, R9, R10, R11)</code></span>
<span class="codeline" id="line-585"><code>	SHA256ROUND0(5, 0x59f111f1, R11, R12, R13, R14, R15, R8, R9, R10)</code></span>
<span class="codeline" id="line-586"><code>	SHA256ROUND0(6, 0x923f82a4, R10, R11, R12, R13, R14, R15, R8, R9)</code></span>
<span class="codeline" id="line-587"><code>	SHA256ROUND0(7, 0xab1c5ed5, R9, R10, R11, R12, R13, R14, R15, R8)</code></span>
<span class="codeline" id="line-588"><code>	SHA256ROUND0(8, 0xd807aa98, R8, R9, R10, R11, R12, R13, R14, R15)</code></span>
<span class="codeline" id="line-589"><code>	SHA256ROUND0(9, 0x12835b01, R15, R8, R9, R10, R11, R12, R13, R14)</code></span>
<span class="codeline" id="line-590"><code>	SHA256ROUND0(10, 0x243185be, R14, R15, R8, R9, R10, R11, R12, R13)</code></span>
<span class="codeline" id="line-591"><code>	SHA256ROUND0(11, 0x550c7dc3, R13, R14, R15, R8, R9, R10, R11, R12)</code></span>
<span class="codeline" id="line-592"><code>	SHA256ROUND0(12, 0x72be5d74, R12, R13, R14, R15, R8, R9, R10, R11)</code></span>
<span class="codeline" id="line-593"><code>	SHA256ROUND0(13, 0x80deb1fe, R11, R12, R13, R14, R15, R8, R9, R10)</code></span>
<span class="codeline" id="line-594"><code>	SHA256ROUND0(14, 0x9bdc06a7, R10, R11, R12, R13, R14, R15, R8, R9)</code></span>
<span class="codeline" id="line-595"><code>	SHA256ROUND0(15, 0xc19bf174, R9, R10, R11, R12, R13, R14, R15, R8)</code></span>
<span class="codeline" id="line-596"><code></code></span>
<span class="codeline" id="line-597"><code>	SHA256ROUND1(16, 0xe49b69c1, R8, R9, R10, R11, R12, R13, R14, R15)</code></span>
<span class="codeline" id="line-598"><code>	SHA256ROUND1(17, 0xefbe4786, R15, R8, R9, R10, R11, R12, R13, R14)</code></span>
<span class="codeline" id="line-599"><code>	SHA256ROUND1(18, 0x0fc19dc6, R14, R15, R8, R9, R10, R11, R12, R13)</code></span>
<span class="codeline" id="line-600"><code>	SHA256ROUND1(19, 0x240ca1cc, R13, R14, R15, R8, R9, R10, R11, R12)</code></span>
<span class="codeline" id="line-601"><code>	SHA256ROUND1(20, 0x2de92c6f, R12, R13, R14, R15, R8, R9, R10, R11)</code></span>
<span class="codeline" id="line-602"><code>	SHA256ROUND1(21, 0x4a7484aa, R11, R12, R13, R14, R15, R8, R9, R10)</code></span>
<span class="codeline" id="line-603"><code>	SHA256ROUND1(22, 0x5cb0a9dc, R10, R11, R12, R13, R14, R15, R8, R9)</code></span>
<span class="codeline" id="line-604"><code>	SHA256ROUND1(23, 0x76f988da, R9, R10, R11, R12, R13, R14, R15, R8)</code></span>
<span class="codeline" id="line-605"><code>	SHA256ROUND1(24, 0x983e5152, R8, R9, R10, R11, R12, R13, R14, R15)</code></span>
<span class="codeline" id="line-606"><code>	SHA256ROUND1(25, 0xa831c66d, R15, R8, R9, R10, R11, R12, R13, R14)</code></span>
<span class="codeline" id="line-607"><code>	SHA256ROUND1(26, 0xb00327c8, R14, R15, R8, R9, R10, R11, R12, R13)</code></span>
<span class="codeline" id="line-608"><code>	SHA256ROUND1(27, 0xbf597fc7, R13, R14, R15, R8, R9, R10, R11, R12)</code></span>
<span class="codeline" id="line-609"><code>	SHA256ROUND1(28, 0xc6e00bf3, R12, R13, R14, R15, R8, R9, R10, R11)</code></span>
<span class="codeline" id="line-610"><code>	SHA256ROUND1(29, 0xd5a79147, R11, R12, R13, R14, R15, R8, R9, R10)</code></span>
<span class="codeline" id="line-611"><code>	SHA256ROUND1(30, 0x06ca6351, R10, R11, R12, R13, R14, R15, R8, R9)</code></span>
<span class="codeline" id="line-612"><code>	SHA256ROUND1(31, 0x14292967, R9, R10, R11, R12, R13, R14, R15, R8)</code></span>
<span class="codeline" id="line-613"><code>	SHA256ROUND1(32, 0x27b70a85, R8, R9, R10, R11, R12, R13, R14, R15)</code></span>
<span class="codeline" id="line-614"><code>	SHA256ROUND1(33, 0x2e1b2138, R15, R8, R9, R10, R11, R12, R13, R14)</code></span>
<span class="codeline" id="line-615"><code>	SHA256ROUND1(34, 0x4d2c6dfc, R14, R15, R8, R9, R10, R11, R12, R13)</code></span>
<span class="codeline" id="line-616"><code>	SHA256ROUND1(35, 0x53380d13, R13, R14, R15, R8, R9, R10, R11, R12)</code></span>
<span class="codeline" id="line-617"><code>	SHA256ROUND1(36, 0x650a7354, R12, R13, R14, R15, R8, R9, R10, R11)</code></span>
<span class="codeline" id="line-618"><code>	SHA256ROUND1(37, 0x766a0abb, R11, R12, R13, R14, R15, R8, R9, R10)</code></span>
<span class="codeline" id="line-619"><code>	SHA256ROUND1(38, 0x81c2c92e, R10, R11, R12, R13, R14, R15, R8, R9)</code></span>
<span class="codeline" id="line-620"><code>	SHA256ROUND1(39, 0x92722c85, R9, R10, R11, R12, R13, R14, R15, R8)</code></span>
<span class="codeline" id="line-621"><code>	SHA256ROUND1(40, 0xa2bfe8a1, R8, R9, R10, R11, R12, R13, R14, R15)</code></span>
<span class="codeline" id="line-622"><code>	SHA256ROUND1(41, 0xa81a664b, R15, R8, R9, R10, R11, R12, R13, R14)</code></span>
<span class="codeline" id="line-623"><code>	SHA256ROUND1(42, 0xc24b8b70, R14, R15, R8, R9, R10, R11, R12, R13)</code></span>
<span class="codeline" id="line-624"><code>	SHA256ROUND1(43, 0xc76c51a3, R13, R14, R15, R8, R9, R10, R11, R12)</code></span>
<span class="codeline" id="line-625"><code>	SHA256ROUND1(44, 0xd192e819, R12, R13, R14, R15, R8, R9, R10, R11)</code></span>
<span class="codeline" id="line-626"><code>	SHA256ROUND1(45, 0xd6990624, R11, R12, R13, R14, R15, R8, R9, R10)</code></span>
<span class="codeline" id="line-627"><code>	SHA256ROUND1(46, 0xf40e3585, R10, R11, R12, R13, R14, R15, R8, R9)</code></span>
<span class="codeline" id="line-628"><code>	SHA256ROUND1(47, 0x106aa070, R9, R10, R11, R12, R13, R14, R15, R8)</code></span>
<span class="codeline" id="line-629"><code>	SHA256ROUND1(48, 0x19a4c116, R8, R9, R10, R11, R12, R13, R14, R15)</code></span>
<span class="codeline" id="line-630"><code>	SHA256ROUND1(49, 0x1e376c08, R15, R8, R9, R10, R11, R12, R13, R14)</code></span>
<span class="codeline" id="line-631"><code>	SHA256ROUND1(50, 0x2748774c, R14, R15, R8, R9, R10, R11, R12, R13)</code></span>
<span class="codeline" id="line-632"><code>	SHA256ROUND1(51, 0x34b0bcb5, R13, R14, R15, R8, R9, R10, R11, R12)</code></span>
<span class="codeline" id="line-633"><code>	SHA256ROUND1(52, 0x391c0cb3, R12, R13, R14, R15, R8, R9, R10, R11)</code></span>
<span class="codeline" id="line-634"><code>	SHA256ROUND1(53, 0x4ed8aa4a, R11, R12, R13, R14, R15, R8, R9, R10)</code></span>
<span class="codeline" id="line-635"><code>	SHA256ROUND1(54, 0x5b9cca4f, R10, R11, R12, R13, R14, R15, R8, R9)</code></span>
<span class="codeline" id="line-636"><code>	SHA256ROUND1(55, 0x682e6ff3, R9, R10, R11, R12, R13, R14, R15, R8)</code></span>
<span class="codeline" id="line-637"><code>	SHA256ROUND1(56, 0x748f82ee, R8, R9, R10, R11, R12, R13, R14, R15)</code></span>
<span class="codeline" id="line-638"><code>	SHA256ROUND1(57, 0x78a5636f, R15, R8, R9, R10, R11, R12, R13, R14)</code></span>
<span class="codeline" id="line-639"><code>	SHA256ROUND1(58, 0x84c87814, R14, R15, R8, R9, R10, R11, R12, R13)</code></span>
<span class="codeline" id="line-640"><code>	SHA256ROUND1(59, 0x8cc70208, R13, R14, R15, R8, R9, R10, R11, R12)</code></span>
<span class="codeline" id="line-641"><code>	SHA256ROUND1(60, 0x90befffa, R12, R13, R14, R15, R8, R9, R10, R11)</code></span>
<span class="codeline" id="line-642"><code>	SHA256ROUND1(61, 0xa4506ceb, R11, R12, R13, R14, R15, R8, R9, R10)</code></span>
<span class="codeline" id="line-643"><code>	SHA256ROUND1(62, 0xbef9a3f7, R10, R11, R12, R13, R14, R15, R8, R9)</code></span>
<span class="codeline" id="line-644"><code>	SHA256ROUND1(63, 0xc67178f2, R9, R10, R11, R12, R13, R14, R15, R8)</code></span>
<span class="codeline" id="line-645"><code></code></span>
<span class="codeline" id="line-646"><code>	MOVQ dig+0(FP), BP</code></span>
<span class="codeline" id="line-647"><code>	ADDL (0*4)(BP), R8  // H0 = a + H0</code></span>
<span class="codeline" id="line-648"><code>	MOVL R8, (0*4)(BP)</code></span>
<span class="codeline" id="line-649"><code>	ADDL (1*4)(BP), R9  // H1 = b + H1</code></span>
<span class="codeline" id="line-650"><code>	MOVL R9, (1*4)(BP)</code></span>
<span class="codeline" id="line-651"><code>	ADDL (2*4)(BP), R10 // H2 = c + H2</code></span>
<span class="codeline" id="line-652"><code>	MOVL R10, (2*4)(BP)</code></span>
<span class="codeline" id="line-653"><code>	ADDL (3*4)(BP), R11 // H3 = d + H3</code></span>
<span class="codeline" id="line-654"><code>	MOVL R11, (3*4)(BP)</code></span>
<span class="codeline" id="line-655"><code>	ADDL (4*4)(BP), R12 // H4 = e + H4</code></span>
<span class="codeline" id="line-656"><code>	MOVL R12, (4*4)(BP)</code></span>
<span class="codeline" id="line-657"><code>	ADDL (5*4)(BP), R13 // H5 = f + H5</code></span>
<span class="codeline" id="line-658"><code>	MOVL R13, (5*4)(BP)</code></span>
<span class="codeline" id="line-659"><code>	ADDL (6*4)(BP), R14 // H6 = g + H6</code></span>
<span class="codeline" id="line-660"><code>	MOVL R14, (6*4)(BP)</code></span>
<span class="codeline" id="line-661"><code>	ADDL (7*4)(BP), R15 // H7 = h + H7</code></span>
<span class="codeline" id="line-662"><code>	MOVL R15, (7*4)(BP)</code></span>
<span class="codeline" id="line-663"><code></code></span>
<span class="codeline" id="line-664"><code>	ADDQ $64, SI</code></span>
<span class="codeline" id="line-665"><code>	CMPQ SI, 256(SP)</code></span>
<span class="codeline" id="line-666"><code>	JB   loop</code></span>
<span class="codeline" id="line-667"><code></code></span>
<span class="codeline" id="line-668"><code>end:</code></span>
<span class="codeline" id="line-669"><code>	RET</code></span>
<span class="codeline" id="line-670"><code></code></span>
<span class="codeline" id="line-671"><code>avx2:</code></span>
<span class="codeline" id="line-672"><code>	MOVQ dig+0(FP), CTX          // d.h[8]</code></span>
<span class="codeline" id="line-673"><code>	MOVQ p_base+8(FP), INP</code></span>
<span class="codeline" id="line-674"><code>	MOVQ p_len+16(FP), NUM_BYTES</code></span>
<span class="codeline" id="line-675"><code></code></span>
<span class="codeline" id="line-676"><code>	LEAQ -64(INP)(NUM_BYTES*1), NUM_BYTES // Pointer to the last block</code></span>
<span class="codeline" id="line-677"><code>	MOVQ NUM_BYTES, _INP_END(SP)</code></span>
<span class="codeline" id="line-678"><code></code></span>
<span class="codeline" id="line-679"><code>	CMPQ NUM_BYTES, INP</code></span>
<span class="codeline" id="line-680"><code>	JE   avx2_only_one_block</code></span>
<span class="codeline" id="line-681"><code></code></span>
<span class="codeline" id="line-682"><code>	// Load initial digest</code></span>
<span class="codeline" id="line-683"><code>	MOVL 0(CTX), a  // a = H0</code></span>
<span class="codeline" id="line-684"><code>	MOVL 4(CTX), b  // b = H1</code></span>
<span class="codeline" id="line-685"><code>	MOVL 8(CTX), c  // c = H2</code></span>
<span class="codeline" id="line-686"><code>	MOVL 12(CTX), d // d = H3</code></span>
<span class="codeline" id="line-687"><code>	MOVL 16(CTX), e // e = H4</code></span>
<span class="codeline" id="line-688"><code>	MOVL 20(CTX), f // f = H5</code></span>
<span class="codeline" id="line-689"><code>	MOVL 24(CTX), g // g = H6</code></span>
<span class="codeline" id="line-690"><code>	MOVL 28(CTX), h // h = H7</code></span>
<span class="codeline" id="line-691"><code></code></span>
<span class="codeline" id="line-692"><code>avx2_loop0: // at each iteration works with one block (512 bit)</code></span>
<span class="codeline" id="line-693"><code></code></span>
<span class="codeline" id="line-694"><code>	VMOVDQU (0*32)(INP), XTMP0</code></span>
<span class="codeline" id="line-695"><code>	VMOVDQU (1*32)(INP), XTMP1</code></span>
<span class="codeline" id="line-696"><code>	VMOVDQU (2*32)(INP), XTMP2</code></span>
<span class="codeline" id="line-697"><code>	VMOVDQU (3*32)(INP), XTMP3</code></span>
<span class="codeline" id="line-698"><code></code></span>
<span class="codeline" id="line-699"><code>	VMOVDQU flip_mask&lt;&gt;(SB), BYTE_FLIP_MASK</code></span>
<span class="codeline" id="line-700"><code></code></span>
<span class="codeline" id="line-701"><code>	// Apply Byte Flip Mask: LE -&gt; BE</code></span>
<span class="codeline" id="line-702"><code>	VPSHUFB BYTE_FLIP_MASK, XTMP0, XTMP0</code></span>
<span class="codeline" id="line-703"><code>	VPSHUFB BYTE_FLIP_MASK, XTMP1, XTMP1</code></span>
<span class="codeline" id="line-704"><code>	VPSHUFB BYTE_FLIP_MASK, XTMP2, XTMP2</code></span>
<span class="codeline" id="line-705"><code>	VPSHUFB BYTE_FLIP_MASK, XTMP3, XTMP3</code></span>
<span class="codeline" id="line-706"><code></code></span>
<span class="codeline" id="line-707"><code>	// Transpose data into high/low parts</code></span>
<span class="codeline" id="line-708"><code>	VPERM2I128 $0x20, XTMP2, XTMP0, XDWORD0 // w3, w2, w1, w0</code></span>
<span class="codeline" id="line-709"><code>	VPERM2I128 $0x31, XTMP2, XTMP0, XDWORD1 // w7, w6, w5, w4</code></span>
<span class="codeline" id="line-710"><code>	VPERM2I128 $0x20, XTMP3, XTMP1, XDWORD2 // w11, w10, w9, w8</code></span>
<span class="codeline" id="line-711"><code>	VPERM2I128 $0x31, XTMP3, XTMP1, XDWORD3 // w15, w14, w13, w12</code></span>
<span class="codeline" id="line-712"><code></code></span>
<span class="codeline" id="line-713"><code>	MOVQ $K256&lt;&gt;(SB), TBL // Loading address of table with round-specific constants</code></span>
<span class="codeline" id="line-714"><code></code></span>
<span class="codeline" id="line-715"><code>avx2_last_block_enter:</code></span>
<span class="codeline" id="line-716"><code>	ADDQ $64, INP</code></span>
<span class="codeline" id="line-717"><code>	MOVQ INP, _INP(SP)</code></span>
<span class="codeline" id="line-718"><code>	XORQ SRND, SRND</code></span>
<span class="codeline" id="line-719"><code></code></span>
<span class="codeline" id="line-720"><code>avx2_loop1: // for w0 - w47</code></span>
<span class="codeline" id="line-721"><code>	// Do 4 rounds and scheduling</code></span>
<span class="codeline" id="line-722"><code>	VPADDD  0*32(TBL)(SRND*1), XDWORD0, XFER</code></span>
<span class="codeline" id="line-723"><code>	VMOVDQU XFER, (_XFER + 0*32)(SP)(SRND*1)</code></span>
<span class="codeline" id="line-724"><code>	ROUND_AND_SCHED_N_0(_XFER + 0*32, a, b, c, d, e, f, g, h, XDWORD0, XDWORD1, XDWORD2, XDWORD3)</code></span>
<span class="codeline" id="line-725"><code>	ROUND_AND_SCHED_N_1(_XFER + 0*32, h, a, b, c, d, e, f, g, XDWORD0, XDWORD1, XDWORD2, XDWORD3)</code></span>
<span class="codeline" id="line-726"><code>	ROUND_AND_SCHED_N_2(_XFER + 0*32, g, h, a, b, c, d, e, f, XDWORD0, XDWORD1, XDWORD2, XDWORD3)</code></span>
<span class="codeline" id="line-727"><code>	ROUND_AND_SCHED_N_3(_XFER + 0*32, f, g, h, a, b, c, d, e, XDWORD0, XDWORD1, XDWORD2, XDWORD3)</code></span>
<span class="codeline" id="line-728"><code></code></span>
<span class="codeline" id="line-729"><code>	// Do 4 rounds and scheduling</code></span>
<span class="codeline" id="line-730"><code>	VPADDD  1*32(TBL)(SRND*1), XDWORD1, XFER</code></span>
<span class="codeline" id="line-731"><code>	VMOVDQU XFER, (_XFER + 1*32)(SP)(SRND*1)</code></span>
<span class="codeline" id="line-732"><code>	ROUND_AND_SCHED_N_0(_XFER + 1*32, e, f, g, h, a, b, c, d, XDWORD1, XDWORD2, XDWORD3, XDWORD0)</code></span>
<span class="codeline" id="line-733"><code>	ROUND_AND_SCHED_N_1(_XFER + 1*32, d, e, f, g, h, a, b, c, XDWORD1, XDWORD2, XDWORD3, XDWORD0)</code></span>
<span class="codeline" id="line-734"><code>	ROUND_AND_SCHED_N_2(_XFER + 1*32, c, d, e, f, g, h, a, b, XDWORD1, XDWORD2, XDWORD3, XDWORD0)</code></span>
<span class="codeline" id="line-735"><code>	ROUND_AND_SCHED_N_3(_XFER + 1*32, b, c, d, e, f, g, h, a, XDWORD1, XDWORD2, XDWORD3, XDWORD0)</code></span>
<span class="codeline" id="line-736"><code></code></span>
<span class="codeline" id="line-737"><code>	// Do 4 rounds and scheduling</code></span>
<span class="codeline" id="line-738"><code>	VPADDD  2*32(TBL)(SRND*1), XDWORD2, XFER</code></span>
<span class="codeline" id="line-739"><code>	VMOVDQU XFER, (_XFER + 2*32)(SP)(SRND*1)</code></span>
<span class="codeline" id="line-740"><code>	ROUND_AND_SCHED_N_0(_XFER + 2*32, a, b, c, d, e, f, g, h, XDWORD2, XDWORD3, XDWORD0, XDWORD1)</code></span>
<span class="codeline" id="line-741"><code>	ROUND_AND_SCHED_N_1(_XFER + 2*32, h, a, b, c, d, e, f, g, XDWORD2, XDWORD3, XDWORD0, XDWORD1)</code></span>
<span class="codeline" id="line-742"><code>	ROUND_AND_SCHED_N_2(_XFER + 2*32, g, h, a, b, c, d, e, f, XDWORD2, XDWORD3, XDWORD0, XDWORD1)</code></span>
<span class="codeline" id="line-743"><code>	ROUND_AND_SCHED_N_3(_XFER + 2*32, f, g, h, a, b, c, d, e, XDWORD2, XDWORD3, XDWORD0, XDWORD1)</code></span>
<span class="codeline" id="line-744"><code></code></span>
<span class="codeline" id="line-745"><code>	// Do 4 rounds and scheduling</code></span>
<span class="codeline" id="line-746"><code>	VPADDD  3*32(TBL)(SRND*1), XDWORD3, XFER</code></span>
<span class="codeline" id="line-747"><code>	VMOVDQU XFER, (_XFER + 3*32)(SP)(SRND*1)</code></span>
<span class="codeline" id="line-748"><code>	ROUND_AND_SCHED_N_0(_XFER + 3*32, e, f, g, h, a, b, c, d, XDWORD3, XDWORD0, XDWORD1, XDWORD2)</code></span>
<span class="codeline" id="line-749"><code>	ROUND_AND_SCHED_N_1(_XFER + 3*32, d, e, f, g, h, a, b, c, XDWORD3, XDWORD0, XDWORD1, XDWORD2)</code></span>
<span class="codeline" id="line-750"><code>	ROUND_AND_SCHED_N_2(_XFER + 3*32, c, d, e, f, g, h, a, b, XDWORD3, XDWORD0, XDWORD1, XDWORD2)</code></span>
<span class="codeline" id="line-751"><code>	ROUND_AND_SCHED_N_3(_XFER + 3*32, b, c, d, e, f, g, h, a, XDWORD3, XDWORD0, XDWORD1, XDWORD2)</code></span>
<span class="codeline" id="line-752"><code></code></span>
<span class="codeline" id="line-753"><code>	ADDQ $4*32, SRND</code></span>
<span class="codeline" id="line-754"><code>	CMPQ SRND, $3*4*32</code></span>
<span class="codeline" id="line-755"><code>	JB   avx2_loop1</code></span>
<span class="codeline" id="line-756"><code></code></span>
<span class="codeline" id="line-757"><code>avx2_loop2:</code></span>
<span class="codeline" id="line-758"><code>	// w48 - w63 processed with no scheduling (last 16 rounds)</code></span>
<span class="codeline" id="line-759"><code>	VPADDD  0*32(TBL)(SRND*1), XDWORD0, XFER</code></span>
<span class="codeline" id="line-760"><code>	VMOVDQU XFER, (_XFER + 0*32)(SP)(SRND*1)</code></span>
<span class="codeline" id="line-761"><code>	DO_ROUND_N_0(_XFER + 0*32, a, b, c, d, e, f, g, h, h)</code></span>
<span class="codeline" id="line-762"><code>	DO_ROUND_N_1(_XFER + 0*32, h, a, b, c, d, e, f, g, h)</code></span>
<span class="codeline" id="line-763"><code>	DO_ROUND_N_2(_XFER + 0*32, g, h, a, b, c, d, e, f, g)</code></span>
<span class="codeline" id="line-764"><code>	DO_ROUND_N_3(_XFER + 0*32, f, g, h, a, b, c, d, e, f)</code></span>
<span class="codeline" id="line-765"><code></code></span>
<span class="codeline" id="line-766"><code>	VPADDD  1*32(TBL)(SRND*1), XDWORD1, XFER</code></span>
<span class="codeline" id="line-767"><code>	VMOVDQU XFER, (_XFER + 1*32)(SP)(SRND*1)</code></span>
<span class="codeline" id="line-768"><code>	DO_ROUND_N_0(_XFER + 1*32, e, f, g, h, a, b, c, d, e)</code></span>
<span class="codeline" id="line-769"><code>	DO_ROUND_N_1(_XFER + 1*32, d, e, f, g, h, a, b, c, d)</code></span>
<span class="codeline" id="line-770"><code>	DO_ROUND_N_2(_XFER + 1*32, c, d, e, f, g, h, a, b, c)</code></span>
<span class="codeline" id="line-771"><code>	DO_ROUND_N_3(_XFER + 1*32, b, c, d, e, f, g, h, a, b)</code></span>
<span class="codeline" id="line-772"><code></code></span>
<span class="codeline" id="line-773"><code>	ADDQ $2*32, SRND</code></span>
<span class="codeline" id="line-774"><code></code></span>
<span class="codeline" id="line-775"><code>	VMOVDQU XDWORD2, XDWORD0</code></span>
<span class="codeline" id="line-776"><code>	VMOVDQU XDWORD3, XDWORD1</code></span>
<span class="codeline" id="line-777"><code></code></span>
<span class="codeline" id="line-778"><code>	CMPQ SRND, $4*4*32</code></span>
<span class="codeline" id="line-779"><code>	JB   avx2_loop2</code></span>
<span class="codeline" id="line-780"><code></code></span>
<span class="codeline" id="line-781"><code>	MOVQ dig+0(FP), CTX // d.h[8]</code></span>
<span class="codeline" id="line-782"><code>	MOVQ _INP(SP), INP</code></span>
<span class="codeline" id="line-783"><code></code></span>
<span class="codeline" id="line-784"><code>	addm(  0(CTX), a)</code></span>
<span class="codeline" id="line-785"><code>	addm(  4(CTX), b)</code></span>
<span class="codeline" id="line-786"><code>	addm(  8(CTX), c)</code></span>
<span class="codeline" id="line-787"><code>	addm( 12(CTX), d)</code></span>
<span class="codeline" id="line-788"><code>	addm( 16(CTX), e)</code></span>
<span class="codeline" id="line-789"><code>	addm( 20(CTX), f)</code></span>
<span class="codeline" id="line-790"><code>	addm( 24(CTX), g)</code></span>
<span class="codeline" id="line-791"><code>	addm( 28(CTX), h)</code></span>
<span class="codeline" id="line-792"><code></code></span>
<span class="codeline" id="line-793"><code>	CMPQ _INP_END(SP), INP</code></span>
<span class="codeline" id="line-794"><code>	JB   done_hash</code></span>
<span class="codeline" id="line-795"><code></code></span>
<span class="codeline" id="line-796"><code>	XORQ SRND, SRND</code></span>
<span class="codeline" id="line-797"><code></code></span>
<span class="codeline" id="line-798"><code>avx2_loop3: // Do second block using previously scheduled results</code></span>
<span class="codeline" id="line-799"><code>	DO_ROUND_N_0(_XFER + 0*32 + 16, a, b, c, d, e, f, g, h, a)</code></span>
<span class="codeline" id="line-800"><code>	DO_ROUND_N_1(_XFER + 0*32 + 16, h, a, b, c, d, e, f, g, h)</code></span>
<span class="codeline" id="line-801"><code>	DO_ROUND_N_2(_XFER + 0*32 + 16, g, h, a, b, c, d, e, f, g)</code></span>
<span class="codeline" id="line-802"><code>	DO_ROUND_N_3(_XFER + 0*32 + 16, f, g, h, a, b, c, d, e, f)</code></span>
<span class="codeline" id="line-803"><code></code></span>
<span class="codeline" id="line-804"><code>	DO_ROUND_N_0(_XFER + 1*32 + 16, e, f, g, h, a, b, c, d, e)</code></span>
<span class="codeline" id="line-805"><code>	DO_ROUND_N_1(_XFER + 1*32 + 16, d, e, f, g, h, a, b, c, d)</code></span>
<span class="codeline" id="line-806"><code>	DO_ROUND_N_2(_XFER + 1*32 + 16, c, d, e, f, g, h, a, b, c)</code></span>
<span class="codeline" id="line-807"><code>	DO_ROUND_N_3(_XFER + 1*32 + 16, b, c, d, e, f, g, h, a, b)</code></span>
<span class="codeline" id="line-808"><code></code></span>
<span class="codeline" id="line-809"><code>	ADDQ $2*32, SRND</code></span>
<span class="codeline" id="line-810"><code>	CMPQ SRND, $4*4*32</code></span>
<span class="codeline" id="line-811"><code>	JB   avx2_loop3</code></span>
<span class="codeline" id="line-812"><code></code></span>
<span class="codeline" id="line-813"><code>	MOVQ dig+0(FP), CTX // d.h[8]</code></span>
<span class="codeline" id="line-814"><code>	MOVQ _INP(SP), INP</code></span>
<span class="codeline" id="line-815"><code>	ADDQ $64, INP</code></span>
<span class="codeline" id="line-816"><code></code></span>
<span class="codeline" id="line-817"><code>	addm(  0(CTX), a)</code></span>
<span class="codeline" id="line-818"><code>	addm(  4(CTX), b)</code></span>
<span class="codeline" id="line-819"><code>	addm(  8(CTX), c)</code></span>
<span class="codeline" id="line-820"><code>	addm( 12(CTX), d)</code></span>
<span class="codeline" id="line-821"><code>	addm( 16(CTX), e)</code></span>
<span class="codeline" id="line-822"><code>	addm( 20(CTX), f)</code></span>
<span class="codeline" id="line-823"><code>	addm( 24(CTX), g)</code></span>
<span class="codeline" id="line-824"><code>	addm( 28(CTX), h)</code></span>
<span class="codeline" id="line-825"><code></code></span>
<span class="codeline" id="line-826"><code>	CMPQ _INP_END(SP), INP</code></span>
<span class="codeline" id="line-827"><code>	JA   avx2_loop0</code></span>
<span class="codeline" id="line-828"><code>	JB   done_hash</code></span>
<span class="codeline" id="line-829"><code></code></span>
<span class="codeline" id="line-830"><code>avx2_do_last_block:</code></span>
<span class="codeline" id="line-831"><code></code></span>
<span class="codeline" id="line-832"><code>	VMOVDQU 0(INP), XWORD0</code></span>
<span class="codeline" id="line-833"><code>	VMOVDQU 16(INP), XWORD1</code></span>
<span class="codeline" id="line-834"><code>	VMOVDQU 32(INP), XWORD2</code></span>
<span class="codeline" id="line-835"><code>	VMOVDQU 48(INP), XWORD3</code></span>
<span class="codeline" id="line-836"><code></code></span>
<span class="codeline" id="line-837"><code>	VMOVDQU flip_mask&lt;&gt;(SB), BYTE_FLIP_MASK</code></span>
<span class="codeline" id="line-838"><code></code></span>
<span class="codeline" id="line-839"><code>	VPSHUFB X_BYTE_FLIP_MASK, XWORD0, XWORD0</code></span>
<span class="codeline" id="line-840"><code>	VPSHUFB X_BYTE_FLIP_MASK, XWORD1, XWORD1</code></span>
<span class="codeline" id="line-841"><code>	VPSHUFB X_BYTE_FLIP_MASK, XWORD2, XWORD2</code></span>
<span class="codeline" id="line-842"><code>	VPSHUFB X_BYTE_FLIP_MASK, XWORD3, XWORD3</code></span>
<span class="codeline" id="line-843"><code></code></span>
<span class="codeline" id="line-844"><code>	MOVQ $K256&lt;&gt;(SB), TBL</code></span>
<span class="codeline" id="line-845"><code></code></span>
<span class="codeline" id="line-846"><code>	JMP avx2_last_block_enter</code></span>
<span class="codeline" id="line-847"><code></code></span>
<span class="codeline" id="line-848"><code>avx2_only_one_block:</code></span>
<span class="codeline" id="line-849"><code>	// Load initial digest</code></span>
<span class="codeline" id="line-850"><code>	MOVL 0(CTX), a  // a = H0</code></span>
<span class="codeline" id="line-851"><code>	MOVL 4(CTX), b  // b = H1</code></span>
<span class="codeline" id="line-852"><code>	MOVL 8(CTX), c  // c = H2</code></span>
<span class="codeline" id="line-853"><code>	MOVL 12(CTX), d // d = H3</code></span>
<span class="codeline" id="line-854"><code>	MOVL 16(CTX), e // e = H4</code></span>
<span class="codeline" id="line-855"><code>	MOVL 20(CTX), f // f = H5</code></span>
<span class="codeline" id="line-856"><code>	MOVL 24(CTX), g // g = H6</code></span>
<span class="codeline" id="line-857"><code>	MOVL 28(CTX), h // h = H7</code></span>
<span class="codeline" id="line-858"><code></code></span>
<span class="codeline" id="line-859"><code>	JMP avx2_do_last_block</code></span>
<span class="codeline" id="line-860"><code></code></span>
<span class="codeline" id="line-861"><code>done_hash:</code></span>
<span class="codeline" id="line-862"><code>	VZEROUPPER</code></span>
<span class="codeline" id="line-863"><code>	RET</code></span>
<span class="codeline" id="line-864"><code></code></span>
<span class="codeline" id="line-865"><code>// shuffle byte order from LE to BE</code></span>
<span class="codeline" id="line-866"><code>DATA flip_mask&lt;&gt;+0x00(SB)/8, $0x0405060700010203</code></span>
<span class="codeline" id="line-867"><code>DATA flip_mask&lt;&gt;+0x08(SB)/8, $0x0c0d0e0f08090a0b</code></span>
<span class="codeline" id="line-868"><code>DATA flip_mask&lt;&gt;+0x10(SB)/8, $0x0405060700010203</code></span>
<span class="codeline" id="line-869"><code>DATA flip_mask&lt;&gt;+0x18(SB)/8, $0x0c0d0e0f08090a0b</code></span>
<span class="codeline" id="line-870"><code>GLOBL flip_mask&lt;&gt;(SB), 8, $32</code></span>
<span class="codeline" id="line-871"><code></code></span>
<span class="codeline" id="line-872"><code>// shuffle xBxA -&gt; 00BA</code></span>
<span class="codeline" id="line-873"><code>DATA shuff_00BA&lt;&gt;+0x00(SB)/8, $0x0b0a090803020100</code></span>
<span class="codeline" id="line-874"><code>DATA shuff_00BA&lt;&gt;+0x08(SB)/8, $0xFFFFFFFFFFFFFFFF</code></span>
<span class="codeline" id="line-875"><code>DATA shuff_00BA&lt;&gt;+0x10(SB)/8, $0x0b0a090803020100</code></span>
<span class="codeline" id="line-876"><code>DATA shuff_00BA&lt;&gt;+0x18(SB)/8, $0xFFFFFFFFFFFFFFFF</code></span>
<span class="codeline" id="line-877"><code>GLOBL shuff_00BA&lt;&gt;(SB), 8, $32</code></span>
<span class="codeline" id="line-878"><code></code></span>
<span class="codeline" id="line-879"><code>// shuffle xDxC -&gt; DC00</code></span>
<span class="codeline" id="line-880"><code>DATA shuff_DC00&lt;&gt;+0x00(SB)/8, $0xFFFFFFFFFFFFFFFF</code></span>
<span class="codeline" id="line-881"><code>DATA shuff_DC00&lt;&gt;+0x08(SB)/8, $0x0b0a090803020100</code></span>
<span class="codeline" id="line-882"><code>DATA shuff_DC00&lt;&gt;+0x10(SB)/8, $0xFFFFFFFFFFFFFFFF</code></span>
<span class="codeline" id="line-883"><code>DATA shuff_DC00&lt;&gt;+0x18(SB)/8, $0x0b0a090803020100</code></span>
<span class="codeline" id="line-884"><code>GLOBL shuff_DC00&lt;&gt;(SB), 8, $32</code></span>
<span class="codeline" id="line-885"><code></code></span>
<span class="codeline" id="line-886"><code>// Round specific constants</code></span>
<span class="codeline" id="line-887"><code>DATA K256&lt;&gt;+0x00(SB)/4, $0x428a2f98 // k1</code></span>
<span class="codeline" id="line-888"><code>DATA K256&lt;&gt;+0x04(SB)/4, $0x71374491 // k2</code></span>
<span class="codeline" id="line-889"><code>DATA K256&lt;&gt;+0x08(SB)/4, $0xb5c0fbcf // k3</code></span>
<span class="codeline" id="line-890"><code>DATA K256&lt;&gt;+0x0c(SB)/4, $0xe9b5dba5 // k4</code></span>
<span class="codeline" id="line-891"><code>DATA K256&lt;&gt;+0x10(SB)/4, $0x428a2f98 // k1</code></span>
<span class="codeline" id="line-892"><code>DATA K256&lt;&gt;+0x14(SB)/4, $0x71374491 // k2</code></span>
<span class="codeline" id="line-893"><code>DATA K256&lt;&gt;+0x18(SB)/4, $0xb5c0fbcf // k3</code></span>
<span class="codeline" id="line-894"><code>DATA K256&lt;&gt;+0x1c(SB)/4, $0xe9b5dba5 // k4</code></span>
<span class="codeline" id="line-895"><code></code></span>
<span class="codeline" id="line-896"><code>DATA K256&lt;&gt;+0x20(SB)/4, $0x3956c25b // k5 - k8</code></span>
<span class="codeline" id="line-897"><code>DATA K256&lt;&gt;+0x24(SB)/4, $0x59f111f1</code></span>
<span class="codeline" id="line-898"><code>DATA K256&lt;&gt;+0x28(SB)/4, $0x923f82a4</code></span>
<span class="codeline" id="line-899"><code>DATA K256&lt;&gt;+0x2c(SB)/4, $0xab1c5ed5</code></span>
<span class="codeline" id="line-900"><code>DATA K256&lt;&gt;+0x30(SB)/4, $0x3956c25b</code></span>
<span class="codeline" id="line-901"><code>DATA K256&lt;&gt;+0x34(SB)/4, $0x59f111f1</code></span>
<span class="codeline" id="line-902"><code>DATA K256&lt;&gt;+0x38(SB)/4, $0x923f82a4</code></span>
<span class="codeline" id="line-903"><code>DATA K256&lt;&gt;+0x3c(SB)/4, $0xab1c5ed5</code></span>
<span class="codeline" id="line-904"><code></code></span>
<span class="codeline" id="line-905"><code>DATA K256&lt;&gt;+0x40(SB)/4, $0xd807aa98 // k9 - k12</code></span>
<span class="codeline" id="line-906"><code>DATA K256&lt;&gt;+0x44(SB)/4, $0x12835b01</code></span>
<span class="codeline" id="line-907"><code>DATA K256&lt;&gt;+0x48(SB)/4, $0x243185be</code></span>
<span class="codeline" id="line-908"><code>DATA K256&lt;&gt;+0x4c(SB)/4, $0x550c7dc3</code></span>
<span class="codeline" id="line-909"><code>DATA K256&lt;&gt;+0x50(SB)/4, $0xd807aa98</code></span>
<span class="codeline" id="line-910"><code>DATA K256&lt;&gt;+0x54(SB)/4, $0x12835b01</code></span>
<span class="codeline" id="line-911"><code>DATA K256&lt;&gt;+0x58(SB)/4, $0x243185be</code></span>
<span class="codeline" id="line-912"><code>DATA K256&lt;&gt;+0x5c(SB)/4, $0x550c7dc3</code></span>
<span class="codeline" id="line-913"><code></code></span>
<span class="codeline" id="line-914"><code>DATA K256&lt;&gt;+0x60(SB)/4, $0x72be5d74 // k13 - k16</code></span>
<span class="codeline" id="line-915"><code>DATA K256&lt;&gt;+0x64(SB)/4, $0x80deb1fe</code></span>
<span class="codeline" id="line-916"><code>DATA K256&lt;&gt;+0x68(SB)/4, $0x9bdc06a7</code></span>
<span class="codeline" id="line-917"><code>DATA K256&lt;&gt;+0x6c(SB)/4, $0xc19bf174</code></span>
<span class="codeline" id="line-918"><code>DATA K256&lt;&gt;+0x70(SB)/4, $0x72be5d74</code></span>
<span class="codeline" id="line-919"><code>DATA K256&lt;&gt;+0x74(SB)/4, $0x80deb1fe</code></span>
<span class="codeline" id="line-920"><code>DATA K256&lt;&gt;+0x78(SB)/4, $0x9bdc06a7</code></span>
<span class="codeline" id="line-921"><code>DATA K256&lt;&gt;+0x7c(SB)/4, $0xc19bf174</code></span>
<span class="codeline" id="line-922"><code></code></span>
<span class="codeline" id="line-923"><code>DATA K256&lt;&gt;+0x80(SB)/4, $0xe49b69c1 // k17 - k20</code></span>
<span class="codeline" id="line-924"><code>DATA K256&lt;&gt;+0x84(SB)/4, $0xefbe4786</code></span>
<span class="codeline" id="line-925"><code>DATA K256&lt;&gt;+0x88(SB)/4, $0x0fc19dc6</code></span>
<span class="codeline" id="line-926"><code>DATA K256&lt;&gt;+0x8c(SB)/4, $0x240ca1cc</code></span>
<span class="codeline" id="line-927"><code>DATA K256&lt;&gt;+0x90(SB)/4, $0xe49b69c1</code></span>
<span class="codeline" id="line-928"><code>DATA K256&lt;&gt;+0x94(SB)/4, $0xefbe4786</code></span>
<span class="codeline" id="line-929"><code>DATA K256&lt;&gt;+0x98(SB)/4, $0x0fc19dc6</code></span>
<span class="codeline" id="line-930"><code>DATA K256&lt;&gt;+0x9c(SB)/4, $0x240ca1cc</code></span>
<span class="codeline" id="line-931"><code></code></span>
<span class="codeline" id="line-932"><code>DATA K256&lt;&gt;+0xa0(SB)/4, $0x2de92c6f // k21 - k24</code></span>
<span class="codeline" id="line-933"><code>DATA K256&lt;&gt;+0xa4(SB)/4, $0x4a7484aa</code></span>
<span class="codeline" id="line-934"><code>DATA K256&lt;&gt;+0xa8(SB)/4, $0x5cb0a9dc</code></span>
<span class="codeline" id="line-935"><code>DATA K256&lt;&gt;+0xac(SB)/4, $0x76f988da</code></span>
<span class="codeline" id="line-936"><code>DATA K256&lt;&gt;+0xb0(SB)/4, $0x2de92c6f</code></span>
<span class="codeline" id="line-937"><code>DATA K256&lt;&gt;+0xb4(SB)/4, $0x4a7484aa</code></span>
<span class="codeline" id="line-938"><code>DATA K256&lt;&gt;+0xb8(SB)/4, $0x5cb0a9dc</code></span>
<span class="codeline" id="line-939"><code>DATA K256&lt;&gt;+0xbc(SB)/4, $0x76f988da</code></span>
<span class="codeline" id="line-940"><code></code></span>
<span class="codeline" id="line-941"><code>DATA K256&lt;&gt;+0xc0(SB)/4, $0x983e5152 // k25 - k28</code></span>
<span class="codeline" id="line-942"><code>DATA K256&lt;&gt;+0xc4(SB)/4, $0xa831c66d</code></span>
<span class="codeline" id="line-943"><code>DATA K256&lt;&gt;+0xc8(SB)/4, $0xb00327c8</code></span>
<span class="codeline" id="line-944"><code>DATA K256&lt;&gt;+0xcc(SB)/4, $0xbf597fc7</code></span>
<span class="codeline" id="line-945"><code>DATA K256&lt;&gt;+0xd0(SB)/4, $0x983e5152</code></span>
<span class="codeline" id="line-946"><code>DATA K256&lt;&gt;+0xd4(SB)/4, $0xa831c66d</code></span>
<span class="codeline" id="line-947"><code>DATA K256&lt;&gt;+0xd8(SB)/4, $0xb00327c8</code></span>
<span class="codeline" id="line-948"><code>DATA K256&lt;&gt;+0xdc(SB)/4, $0xbf597fc7</code></span>
<span class="codeline" id="line-949"><code></code></span>
<span class="codeline" id="line-950"><code>DATA K256&lt;&gt;+0xe0(SB)/4, $0xc6e00bf3 // k29 - k32</code></span>
<span class="codeline" id="line-951"><code>DATA K256&lt;&gt;+0xe4(SB)/4, $0xd5a79147</code></span>
<span class="codeline" id="line-952"><code>DATA K256&lt;&gt;+0xe8(SB)/4, $0x06ca6351</code></span>
<span class="codeline" id="line-953"><code>DATA K256&lt;&gt;+0xec(SB)/4, $0x14292967</code></span>
<span class="codeline" id="line-954"><code>DATA K256&lt;&gt;+0xf0(SB)/4, $0xc6e00bf3</code></span>
<span class="codeline" id="line-955"><code>DATA K256&lt;&gt;+0xf4(SB)/4, $0xd5a79147</code></span>
<span class="codeline" id="line-956"><code>DATA K256&lt;&gt;+0xf8(SB)/4, $0x06ca6351</code></span>
<span class="codeline" id="line-957"><code>DATA K256&lt;&gt;+0xfc(SB)/4, $0x14292967</code></span>
<span class="codeline" id="line-958"><code></code></span>
<span class="codeline" id="line-959"><code>DATA K256&lt;&gt;+0x100(SB)/4, $0x27b70a85</code></span>
<span class="codeline" id="line-960"><code>DATA K256&lt;&gt;+0x104(SB)/4, $0x2e1b2138</code></span>
<span class="codeline" id="line-961"><code>DATA K256&lt;&gt;+0x108(SB)/4, $0x4d2c6dfc</code></span>
<span class="codeline" id="line-962"><code>DATA K256&lt;&gt;+0x10c(SB)/4, $0x53380d13</code></span>
<span class="codeline" id="line-963"><code>DATA K256&lt;&gt;+0x110(SB)/4, $0x27b70a85</code></span>
<span class="codeline" id="line-964"><code>DATA K256&lt;&gt;+0x114(SB)/4, $0x2e1b2138</code></span>
<span class="codeline" id="line-965"><code>DATA K256&lt;&gt;+0x118(SB)/4, $0x4d2c6dfc</code></span>
<span class="codeline" id="line-966"><code>DATA K256&lt;&gt;+0x11c(SB)/4, $0x53380d13</code></span>
<span class="codeline" id="line-967"><code></code></span>
<span class="codeline" id="line-968"><code>DATA K256&lt;&gt;+0x120(SB)/4, $0x650a7354</code></span>
<span class="codeline" id="line-969"><code>DATA K256&lt;&gt;+0x124(SB)/4, $0x766a0abb</code></span>
<span class="codeline" id="line-970"><code>DATA K256&lt;&gt;+0x128(SB)/4, $0x81c2c92e</code></span>
<span class="codeline" id="line-971"><code>DATA K256&lt;&gt;+0x12c(SB)/4, $0x92722c85</code></span>
<span class="codeline" id="line-972"><code>DATA K256&lt;&gt;+0x130(SB)/4, $0x650a7354</code></span>
<span class="codeline" id="line-973"><code>DATA K256&lt;&gt;+0x134(SB)/4, $0x766a0abb</code></span>
<span class="codeline" id="line-974"><code>DATA K256&lt;&gt;+0x138(SB)/4, $0x81c2c92e</code></span>
<span class="codeline" id="line-975"><code>DATA K256&lt;&gt;+0x13c(SB)/4, $0x92722c85</code></span>
<span class="codeline" id="line-976"><code></code></span>
<span class="codeline" id="line-977"><code>DATA K256&lt;&gt;+0x140(SB)/4, $0xa2bfe8a1</code></span>
<span class="codeline" id="line-978"><code>DATA K256&lt;&gt;+0x144(SB)/4, $0xa81a664b</code></span>
<span class="codeline" id="line-979"><code>DATA K256&lt;&gt;+0x148(SB)/4, $0xc24b8b70</code></span>
<span class="codeline" id="line-980"><code>DATA K256&lt;&gt;+0x14c(SB)/4, $0xc76c51a3</code></span>
<span class="codeline" id="line-981"><code>DATA K256&lt;&gt;+0x150(SB)/4, $0xa2bfe8a1</code></span>
<span class="codeline" id="line-982"><code>DATA K256&lt;&gt;+0x154(SB)/4, $0xa81a664b</code></span>
<span class="codeline" id="line-983"><code>DATA K256&lt;&gt;+0x158(SB)/4, $0xc24b8b70</code></span>
<span class="codeline" id="line-984"><code>DATA K256&lt;&gt;+0x15c(SB)/4, $0xc76c51a3</code></span>
<span class="codeline" id="line-985"><code></code></span>
<span class="codeline" id="line-986"><code>DATA K256&lt;&gt;+0x160(SB)/4, $0xd192e819</code></span>
<span class="codeline" id="line-987"><code>DATA K256&lt;&gt;+0x164(SB)/4, $0xd6990624</code></span>
<span class="codeline" id="line-988"><code>DATA K256&lt;&gt;+0x168(SB)/4, $0xf40e3585</code></span>
<span class="codeline" id="line-989"><code>DATA K256&lt;&gt;+0x16c(SB)/4, $0x106aa070</code></span>
<span class="codeline" id="line-990"><code>DATA K256&lt;&gt;+0x170(SB)/4, $0xd192e819</code></span>
<span class="codeline" id="line-991"><code>DATA K256&lt;&gt;+0x174(SB)/4, $0xd6990624</code></span>
<span class="codeline" id="line-992"><code>DATA K256&lt;&gt;+0x178(SB)/4, $0xf40e3585</code></span>
<span class="codeline" id="line-993"><code>DATA K256&lt;&gt;+0x17c(SB)/4, $0x106aa070</code></span>
<span class="codeline" id="line-994"><code></code></span>
<span class="codeline" id="line-995"><code>DATA K256&lt;&gt;+0x180(SB)/4, $0x19a4c116</code></span>
<span class="codeline" id="line-996"><code>DATA K256&lt;&gt;+0x184(SB)/4, $0x1e376c08</code></span>
<span class="codeline" id="line-997"><code>DATA K256&lt;&gt;+0x188(SB)/4, $0x2748774c</code></span>
<span class="codeline" id="line-998"><code>DATA K256&lt;&gt;+0x18c(SB)/4, $0x34b0bcb5</code></span>
<span class="codeline" id="line-999"><code>DATA K256&lt;&gt;+0x190(SB)/4, $0x19a4c116</code></span>
<span class="codeline" id="line-1000"><code>DATA K256&lt;&gt;+0x194(SB)/4, $0x1e376c08</code></span>
<span class="codeline" id="line-1001"><code>DATA K256&lt;&gt;+0x198(SB)/4, $0x2748774c</code></span>
<span class="codeline" id="line-1002"><code>DATA K256&lt;&gt;+0x19c(SB)/4, $0x34b0bcb5</code></span>
<span class="codeline" id="line-1003"><code></code></span>
<span class="codeline" id="line-1004"><code>DATA K256&lt;&gt;+0x1a0(SB)/4, $0x391c0cb3</code></span>
<span class="codeline" id="line-1005"><code>DATA K256&lt;&gt;+0x1a4(SB)/4, $0x4ed8aa4a</code></span>
<span class="codeline" id="line-1006"><code>DATA K256&lt;&gt;+0x1a8(SB)/4, $0x5b9cca4f</code></span>
<span class="codeline" id="line-1007"><code>DATA K256&lt;&gt;+0x1ac(SB)/4, $0x682e6ff3</code></span>
<span class="codeline" id="line-1008"><code>DATA K256&lt;&gt;+0x1b0(SB)/4, $0x391c0cb3</code></span>
<span class="codeline" id="line-1009"><code>DATA K256&lt;&gt;+0x1b4(SB)/4, $0x4ed8aa4a</code></span>
<span class="codeline" id="line-1010"><code>DATA K256&lt;&gt;+0x1b8(SB)/4, $0x5b9cca4f</code></span>
<span class="codeline" id="line-1011"><code>DATA K256&lt;&gt;+0x1bc(SB)/4, $0x682e6ff3</code></span>
<span class="codeline" id="line-1012"><code></code></span>
<span class="codeline" id="line-1013"><code>DATA K256&lt;&gt;+0x1c0(SB)/4, $0x748f82ee</code></span>
<span class="codeline" id="line-1014"><code>DATA K256&lt;&gt;+0x1c4(SB)/4, $0x78a5636f</code></span>
<span class="codeline" id="line-1015"><code>DATA K256&lt;&gt;+0x1c8(SB)/4, $0x84c87814</code></span>
<span class="codeline" id="line-1016"><code>DATA K256&lt;&gt;+0x1cc(SB)/4, $0x8cc70208</code></span>
<span class="codeline" id="line-1017"><code>DATA K256&lt;&gt;+0x1d0(SB)/4, $0x748f82ee</code></span>
<span class="codeline" id="line-1018"><code>DATA K256&lt;&gt;+0x1d4(SB)/4, $0x78a5636f</code></span>
<span class="codeline" id="line-1019"><code>DATA K256&lt;&gt;+0x1d8(SB)/4, $0x84c87814</code></span>
<span class="codeline" id="line-1020"><code>DATA K256&lt;&gt;+0x1dc(SB)/4, $0x8cc70208</code></span>
<span class="codeline" id="line-1021"><code></code></span>
<span class="codeline" id="line-1022"><code>DATA K256&lt;&gt;+0x1e0(SB)/4, $0x90befffa</code></span>
<span class="codeline" id="line-1023"><code>DATA K256&lt;&gt;+0x1e4(SB)/4, $0xa4506ceb</code></span>
<span class="codeline" id="line-1024"><code>DATA K256&lt;&gt;+0x1e8(SB)/4, $0xbef9a3f7</code></span>
<span class="codeline" id="line-1025"><code>DATA K256&lt;&gt;+0x1ec(SB)/4, $0xc67178f2</code></span>
<span class="codeline" id="line-1026"><code>DATA K256&lt;&gt;+0x1f0(SB)/4, $0x90befffa</code></span>
<span class="codeline" id="line-1027"><code>DATA K256&lt;&gt;+0x1f4(SB)/4, $0xa4506ceb</code></span>
<span class="codeline" id="line-1028"><code>DATA K256&lt;&gt;+0x1f8(SB)/4, $0xbef9a3f7</code></span>
<span class="codeline" id="line-1029"><code>DATA K256&lt;&gt;+0x1fc(SB)/4, $0xc67178f2</code></span>
<span class="codeline" id="line-1030"><code></code></span>
<span class="codeline" id="line-1031"><code>GLOBL K256&lt;&gt;(SB), (NOPTR + RODATA), $512</code></span>
</pre><pre id="footer">
<table><tr><td><img src="../../../png/go101-twitter.png"></td>
<td>The pages are generated with <a href="https://go101.org/article/tool-golds.html"><b>Golds</b></a> <i>v0.4.1</i>. (GOOS=linux GOARCH=amd64)
<b>Golds</b> is a <a href="https://go101.org">Go 101</a> project developed by <a href="https://tapirgames.com">Tapir Liu</a>.
PR and bug reports are welcome and can be submitted to <a href="https://github.com/go101/golds">the issue list</a>.
Please follow <a href="https://twitter.com/go100and1">@Go100and1</a> (reachable from the left QR code) to get the latest news of <b>Golds</b>.</td></tr></table></pre>