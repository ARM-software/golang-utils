<!DOCTYPE html>
<!--
-- Copyright (C) 2020-2022 Arm Limited or its affiliates and Contributors. All rights reserved.
-- SPDX-License-Identifier: Apache-2.0
-->
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Package: runtime/trace</title>
<link href="../../css/light-v0.4.1.css" rel="stylesheet">
<script src="../../jvs/golds-v0.4.1.js"></script>
<body onload="onPageLoad()"><div>

<pre id="package-details"><code><span style="font-size:xx-large;">package <b>trace</b></span>

<span class="title">Import Path</span>
	<a href="../../index.html#pkg-runtime/trace">runtime/trace</a><i> (on <a href="https://pkg.go.dev/runtime/trace" target="_blank">go.dev</a>)</i>

<span class="title">Dependency Relation</span>
	imports <a href="../../dep/runtime/trace.html">7 packages</a>, and imported by <a href="../../dep/runtime/trace.html#imported-by">one package</a>

<div id="files"><span class="title">Involved Source Files</span>

	<span class="nodocs">      <a href="../../src/runtime/trace/annotation.go.html">annotation.go</a></span>
	<input type='checkbox' checked class="fold" id="file-1-fold-content"><label for="file-1-fold-content">   <a href="../../src/runtime/trace/trace.go.html#doc">#d</a> <a href="../../src/runtime/trace/trace.go.html">trace.go</a></label><span id='file-1-fold-content-items' class="fold-items">
		Package trace contains facilities for programs to generate traces
		for the Go execution tracer.

		Tracing runtime activities

		The execution trace captures a wide range of execution events such as
		goroutine creation/blocking/unblocking, syscall enter/exit/block,
		GC-related events, changes of heap size, processor start/stop, etc.
		A precise nanosecond-precision timestamp and a stack trace is
		captured for most events. The generated trace can be interpreted
		using `go tool trace`.

		Support for tracing tests and benchmarks built with the standard
		testing package is built into `go test`. For example, the following
		command runs the test in the current directory and writes the trace
		file (trace.out).

		   go test -trace=trace.out

		This runtime/trace package provides APIs to add equivalent tracing
		support to a standalone program. See the Example that demonstrates
		how to use this API to enable tracing.

		There is also a standard HTTP interface to trace data. Adding the
		following line will install a handler under the /debug/pprof/trace URL
		to download a live trace:

		    import _ "net/http/pprof"

		See the net/http/pprof package for more details about all of the
		debug endpoints installed by this import.

		User annotation

		Package trace provides user annotation APIs that can be used to
		log interesting events during execution.

		There are three types of user annotations: log messages, regions,
		and tasks.

		Log emits a timestamped message to the execution trace along with
		additional information such as the category of the message and
		which goroutine called Log. The execution tracer provides UIs to filter
		and group goroutines using the log category and the message supplied
		in Log.

		A region is for logging a time interval during a goroutine's execution.
		By definition, a region starts and ends in the same goroutine.
		Regions can be nested to represent subintervals.
		For example, the following code records four regions in the execution
		trace to trace the durations of sequential steps in a cappuccino making
		operation.

		  trace.WithRegion(ctx, "makeCappuccino", func() {

		     // orderID allows to identify a specific order
		     // among many cappuccino order region records.
		     trace.Log(ctx, "orderID", orderID)

		     trace.WithRegion(ctx, "steamMilk", steamMilk)
		     trace.WithRegion(ctx, "extractCoffee", extractCoffee)
		     trace.WithRegion(ctx, "mixMilkCoffee", mixMilkCoffee)
		  })

		A task is a higher-level component that aids tracing of logical
		operations such as an RPC request, an HTTP request, or an
		interesting local operation which may require multiple goroutines
		working together. Since tasks can involve multiple goroutines,
		they are tracked via a context.Context object. NewTask creates
		a new task and embeds it in the returned context.Context object.
		Log messages and regions are attached to the task, if any, in the
		Context passed to Log and WithRegion.

		For example, assume that we decided to froth milk, extract coffee,
		and mix milk and coffee in separate goroutines. With a task,
		the trace tool can identify the goroutines involved in a specific
		cappuccino order.

		     ctx, task := trace.NewTask(ctx, "makeCappuccino")
		     trace.Log(ctx, "orderID", orderID)

		     milk := make(chan bool)
		     espresso := make(chan bool)

		     go func() {
		             trace.WithRegion(ctx, "steamMilk", steamMilk)
		             milk &lt;- true
		     }()
		     go func() {
		             trace.WithRegion(ctx, "extractCoffee", extractCoffee)
		             espresso &lt;- true
		     }()
		     go func() {
		             defer task.End() // When assemble is done, the order is complete.
		             &lt;-espresso
		             &lt;-milk
		             trace.WithRegion(ctx, "mixMilkCoffee", mixMilkCoffee)
		     }()

		The trace tool computes the latency of a task by measuring the
		time between the task creation and the task end and provides
		latency distributions for each task type found in the trace.</span></div>
<div id="examples"><span class="title">Code Examples</span>

	<input type='checkbox' class="fold" id="example-0-fold-content"><label for="example-0-fold-content"></label><span id='example-0-fold-content-items' class="fold-items">
		package main
		
		import (
			"fmt"
			"log"
			"os"
			"runtime/trace"
		)
		
		// Example demonstrates the use of the trace package to trace
		// the execution of a Go program. The trace output will be
		// written to the file trace.out
		func main() {
			f, err := os.Create("trace.out")
			if err != nil {
				log.Fatalf("failed to create trace output file: %v", err)
			}
			defer func() {
				if err := f.Close(); err != nil {
					log.Fatalf("failed to close trace file: %v", err)
				}
			}()
		
			if err := trace.Start(f); err != nil {
				log.Fatalf("failed to start trace: %v", err)
			}
			defer trace.Stop()
		
			// your program here
			RunMyProgram()
		}
		
		func RunMyProgram() {
			fmt.Printf("this function will be traced")
		}
</span>
</div>
<div id="exported-types"><span class="title">Package-Level Type Names<span class="title-stat"><i> (total 3, in which 2 are exported)</i></span></span>

<div id="exported-types-buttons" class="js-on">	/* sort exporteds by: <label id="sort-types-by-alphabet" class="button">alphabet</label> | <label id="sort-types-by-popularity" class="button">popularity</label> */</div><div class="anchor type-res" id="name-Region" data-popularity="130">	<input type='checkbox' class="fold" id="Region-fold-content"><label for="Region-fold-content"> type <a href="../../src/runtime/trace/annotation.go.html#line-163">Region</a> <i>(struct)</i></label><span id='Region-fold-content-docs' class="fold-docs">
		Region is a region of code whose execution time interval is traced.

		<input type='checkbox' class="fold" id="Region-fold-fields"><label for="Region-fold-fields">Fields (<i>total 2, neither is exported</i>)</label><span id='Region-fold-fields-items' class="fold-items">
			<input type='checkbox' class="showhide" id="Region-showhide-fields"><i><label for="Region-showhide-fields" class="show-inline">/* 2 unexporteds ... */</label><label for="Region-showhide-fields" class="hide-inline">/* 2 unexporteds: */</label></i><span class="hidden"><i>
			<span class="nodocs"><a href="../../src/runtime/trace/annotation.go.html#line-164">id</a> <i><a href="../builtin.html#name-uint64">uint64</a></i></span></i></span><span class="hidden"><i>
			<span class="nodocs"><a href="../../src/runtime/trace/annotation.go.html#line-165">regionType</a> <i><a href="../builtin.html#name-string">string</a></i></span></i></span></span>
		<input type='checkbox' class="fold" id="Region-fold-methods"><label for="Region-fold-methods">Methods (<i>only one, which is exported</i>)</label><span id='Region-fold-methods-items' class="fold-items"><span>
			<input type='checkbox' class="fold" id="Region-fold-method-End"><label for="Region-fold-method-End">(*T) <a href="../../src/runtime/trace/annotation.go.html#line-171">End</a>()</label><span id='Region-fold-method-End-docs' class="fold-docs">
				End marks the end of the traced code region.
</span></span></span>
		<input type='checkbox' class="fold" id="Region-fold-results"><label for="Region-fold-results">As Outputs Of (<i>at least one exported</i>)</label><span id='Region-fold-results-items' class="fold-items"><span>
			func <a href="#name-StartRegion">StartRegion</a>(ctx <a href="../context.html">context</a>.<a href="../context.html#name-Context">Context</a>, regionType <a href="../builtin.html#name-string">string</a>) *<b>Region</b></span></span>
		<input type='checkbox' class="fold" id="Region-fold-values"><label for="Region-fold-values">As Types Of (<i>only one, which is unexported</i>)</label><span id='Region-fold-values-items' class="fold-items">
			<input type='checkbox' class="showhide" id="Region-showhide-values"><i><label for="Region-showhide-values" class="show-inline">/* one unexported ... */</label><label for="Region-showhide-values" class="hide-inline">/* one unexported: */</label></i><span class="hidden"><i>
			  var <a href="#name-noopRegion">noopRegion</a> *Region</i></span></span>

</span></div><div class="anchor type-res" id="name-Task" data-popularity="205">	<input type='checkbox' class="fold" id="Task-fold-content"><label for="Task-fold-content"> type <a href="../../src/runtime/trace/annotation.go.html#line-73">Task</a> <i>(struct)</i></label><span id='Task-fold-content-docs' class="fold-docs">
		Task is a data type for tracing a user-defined, logical operation.

		<input type='checkbox' class="fold" id="Task-fold-fields"><label for="Task-fold-fields">Fields (<i>only one, which is unexported</i>)</label><span id='Task-fold-fields-items' class="fold-items">
			<input type='checkbox' class="showhide" id="Task-showhide-fields"><i><label for="Task-showhide-fields" class="show-inline">/* one unexported ... */</label><label for="Task-showhide-fields" class="hide-inline">/* one unexported: */</label></i><span class="hidden"><i>
			<span class="nodocs"><a href="../../src/runtime/trace/annotation.go.html#line-74">id</a> <i><a href="../builtin.html#name-uint64">uint64</a></i></span></i></span></span>
		<input type='checkbox' class="fold" id="Task-fold-methods"><label for="Task-fold-methods">Methods (<i>only one, which is exported</i>)</label><span id='Task-fold-methods-items' class="fold-items"><span>
			<input type='checkbox' class="fold" id="Task-fold-method-End"><label for="Task-fold-method-End">(*T) <a href="../../src/runtime/trace/annotation.go.html#line-79">End</a>()</label><span id='Task-fold-method-End-docs' class="fold-docs">
				End marks the end of the operation represented by the Task.
</span></span></span>
		<input type='checkbox' class="fold" id="Task-fold-results"><label for="Task-fold-results">As Outputs Of (<i>at least 2, in which 1 are exported</i>)</label><span id='Task-fold-results-items' class="fold-items"><span>
			func <a href="#name-NewTask">NewTask</a>(pctx <a href="../context.html">context</a>.<a href="../context.html#name-Context">Context</a>, taskType <a href="../builtin.html#name-string">string</a>) (ctx <a href="../context.html">context</a>.<a href="../context.html#name-Context">Context</a>, task *<b>Task</b>)</span>
			<input type='checkbox' class="showhide" id="Task-showhide-inputofs"><i><label for="Task-showhide-inputofs" class="show-inline">/* at least one unexported ... */</label><label for="Task-showhide-inputofs" class="hide-inline">/* at least one unexported: */</label></i><span class="hidden"><i>
			func <a href="#name-fromContext">fromContext</a>(ctx <a href="../context.html">context</a>.<a href="../context.html#name-Context">Context</a>) *<b>Task</b></i></span></span>
		<input type='checkbox' class="fold" id="Task-fold-values"><label for="Task-fold-values">As Types Of (<i>only one, which is unexported</i>)</label><span id='Task-fold-values-items' class="fold-items">
			<input type='checkbox' class="showhide" id="Task-showhide-values"><i><label for="Task-showhide-values" class="show-inline">/* one unexported ... */</label><label for="Task-showhide-values" class="hide-inline">/* one unexported: */</label></i><span class="hidden"><i>
			  var <a href="#name-bgTask">bgTask</a></i></span></span>

</span></div></div><div>	<input type='checkbox' class="showhide" id="unexported-typenames-showhide"><i><label for="unexported-typenames-showhide" class="show-inline">/* one unexported ... */</label><label for="unexported-typenames-showhide" class="hide-inline">/* one unexported: */</label></i><div class="anchor type-res hidden" id="name-traceContextKey" data-popularity="0">	<span class="nodocs"> type <a href="../../src/runtime/trace/annotation.go.html#line-14">traceContextKey</a> <i>(struct)</i></span></div></div>
<div id="exported-functions"><span class="title">Package-Level Functions<span class="title-stat"><i> (total 14, in which 8 are exported)</i></span></span>

<div class="anchor value-res" id="name-IsEnabled">	<input type='checkbox' class="fold" id="IsEnabled-fold-content"><label for="IsEnabled-fold-content"> func <a href="../../src/runtime/trace/annotation.go.html#line-181">IsEnabled</a>() <a href="../builtin.html#name-bool">bool</a></label><span id='IsEnabled-fold-content-docs' class="fold-docs">
		IsEnabled reports whether tracing is enabled.
		The information is advisory only. The tracing status
		may have changed by the time this function returns.

</span></div><div class="anchor value-res" id="name-Log">	<input type='checkbox' class="fold" id="Log-fold-content"><label for="Log-fold-content"> func <a href="../../src/runtime/trace/annotation.go.html#line-95">Log</a>(ctx <a href="../context.html">context</a>.<a href="../context.html#name-Context">Context</a>, category, message <a href="../builtin.html#name-string">string</a>)</label><span id='Log-fold-content-docs' class="fold-docs">
		Log emits a one-off event with the given category and message.
		Category can be empty and the API assumes there are only a handful of
		unique categories in the system.

</span></div><div class="anchor value-res" id="name-Logf">	<input type='checkbox' class="fold" id="Logf-fold-content"><label for="Logf-fold-content"> func <a href="../../src/runtime/trace/annotation.go.html#line-101">Logf</a>(ctx <a href="../context.html">context</a>.<a href="../context.html#name-Context">Context</a>, category, format <a href="../builtin.html#name-string">string</a>, args ...interface{})</label><span id='Logf-fold-content-docs' class="fold-docs">
		Logf is like Log, but the value is formatted using the specified format spec.

</span></div><div class="anchor value-res" id="name-NewTask">	<input type='checkbox' class="fold" id="NewTask-fold-content"><label for="NewTask-fold-content"> func <a href="../../src/runtime/trace/annotation.go.html#line-38">NewTask</a>(pctx <a href="../context.html">context</a>.<a href="../context.html#name-Context">Context</a>, taskType <a href="../builtin.html#name-string">string</a>) (ctx <a href="../context.html">context</a>.<a href="../context.html#name-Context">Context</a>, task *<a href="#name-Task">Task</a>)</label><span id='NewTask-fold-content-docs' class="fold-docs">
		NewTask creates a task instance with the type taskType and returns
		it along with a Context that carries the task.
		If the input context contains a task, the new task is its subtask.

		The taskType is used to classify task instances. Analysis tools
		like the Go execution tracer may assume there are only a bounded
		number of unique task types in the system.

		The returned end function is used to mark the task's end.
		The trace tool measures task latency as the time between task creation
		and when the end function is called, and provides the latency
		distribution per task type.
		If the end function is called multiple times, only the first
		call is used in the latency measurement.

		  ctx, task := trace.NewTask(ctx, "awesomeTask")
		  trace.WithRegion(ctx, "preparation", prepWork)
		  // preparation of the task
		  go func() {  // continue processing the task in a separate goroutine.
		      defer task.End()
		      trace.WithRegion(ctx, "remainingWork", remainingWork)
		  }()

</span></div><div class="anchor value-res" id="name-Start">	<input type='checkbox' class="fold" id="Start-fold-content"><label for="Start-fold-content"> func <a href="../../src/runtime/trace/trace.go.html#line-120">Start</a>(w <a href="../io.html">io</a>.<a href="../io.html#name-Writer">Writer</a>) <a href="../builtin.html#name-error">error</a></label><span id='Start-fold-content-docs' class="fold-docs">
		Start enables tracing for the current program.
		While tracing, the trace will be buffered and written to w.
		Start returns an error if tracing is already enabled.

</span></div><div class="anchor value-res" id="name-StartRegion">	<input type='checkbox' class="fold" id="StartRegion-fold-content"><label for="StartRegion-fold-content"> func <a href="../../src/runtime/trace/annotation.go.html#line-153">StartRegion</a>(ctx <a href="../context.html">context</a>.<a href="../context.html#name-Context">Context</a>, regionType <a href="../builtin.html#name-string">string</a>) *<a href="#name-Region">Region</a></label><span id='StartRegion-fold-content-docs' class="fold-docs">
		StartRegion starts a region and returns a function for marking the
		end of the region. The returned Region's End function must be called
		from the same goroutine where the region was started.
		Within each goroutine, regions must nest. That is, regions started
		after this region must be ended before this region can be ended.
		Recommended usage is

		    defer trace.StartRegion(ctx, "myTracedRegion").End()

</span></div><div class="anchor value-res" id="name-Stop">	<input type='checkbox' class="fold" id="Stop-fold-content"><label for="Stop-fold-content"> func <a href="../../src/runtime/trace/trace.go.html#line-142">Stop</a>()</label><span id='Stop-fold-content-docs' class="fold-docs">
		Stop stops the current tracing, if any.
		Stop only returns after all the writes for the trace have completed.

</span></div><div class="anchor value-res" id="name-WithRegion">	<input type='checkbox' class="fold" id="WithRegion-fold-content"><label for="WithRegion-fold-content"> func <a href="../../src/runtime/trace/annotation.go.html#line-122">WithRegion</a>(ctx <a href="../context.html">context</a>.<a href="../context.html#name-Context">Context</a>, regionType <a href="../builtin.html#name-string">string</a>, fn func())</label><span id='WithRegion-fold-content-docs' class="fold-docs">
		WithRegion starts a region associated with its calling goroutine, runs fn,
		and then ends the region. If the context carries a task, the region is
		associated with the task. Otherwise, the region is attached to the background
		task.

		The regionType is used to classify regions, so there should be only a
		handful of unique region types.

</span></div>	<input type='checkbox' class="showhide" id="unexported-functions-showhide"><i><label for="unexported-functions-showhide" class="show-inline">/* 6 unexporteds ... */</label><label for="unexported-functions-showhide" class="hide-inline">/* 6 unexporteds: */</label></i><div class="anchor value-res hidden" id="name-fromContext"><i>	<span class="nodocs"> func <a href="../../src/runtime/trace/annotation.go.html#line-65">fromContext</a>(ctx <a href="../context.html">context</a>.<a href="../context.html#name-Context">Context</a>) *<a href="#name-Task">Task</a></span></i></div><div class="anchor value-res hidden" id="name-newID"><i>	<span class="nodocs"> func <a href="../../src/runtime/trace/annotation.go.html#line-85">newID</a>() <a href="../builtin.html#name-uint64">uint64</a></span></i></div><div class="anchor value-res hidden" id="name-userLog"><i>	<input type='checkbox' class="fold" id="userLog-fold-content"><label for="userLog-fold-content"> func <a href="../../src/runtime/trace/annotation.go.html#line-200">userLog</a>(id <a href="../builtin.html#name-uint64">uint64</a>, category, message <a href="../builtin.html#name-string">string</a>)</label><span id='userLog-fold-content-docs' class="fold-docs">
		emits UserLog event.

</span></i></div><div class="anchor value-res hidden" id="name-userRegion"><i>	<input type='checkbox' class="fold" id="userRegion-fold-content"><label for="userRegion-fold-content"> func <a href="../../src/runtime/trace/annotation.go.html#line-197">userRegion</a>(id, mode <a href="../builtin.html#name-uint64">uint64</a>, regionType <a href="../builtin.html#name-string">string</a>)</label><span id='userRegion-fold-content-docs' class="fold-docs">
		emits UserRegion event.

</span></i></div><div class="anchor value-res hidden" id="name-userTaskCreate"><i>	<input type='checkbox' class="fold" id="userTaskCreate-fold-content"><label for="userTaskCreate-fold-content"> func <a href="../../src/runtime/trace/annotation.go.html#line-191">userTaskCreate</a>(id, parentID <a href="../builtin.html#name-uint64">uint64</a>, taskType <a href="../builtin.html#name-string">string</a>)</label><span id='userTaskCreate-fold-content-docs' class="fold-docs">
		emits UserTaskCreate event.

</span></i></div><div class="anchor value-res hidden" id="name-userTaskEnd"><i>	<input type='checkbox' class="fold" id="userTaskEnd-fold-content"><label for="userTaskEnd-fold-content"> func <a href="../../src/runtime/trace/annotation.go.html#line-194">userTaskEnd</a>(id <a href="../builtin.html#name-uint64">uint64</a>)</label><span id='userTaskEnd-fold-content-docs' class="fold-docs">
		emits UserTaskEnd event.

</span></i></div></div>
<div id="exported-variables"><span class="title">Package-Level Variables<span class="title-stat"><i> (total 4, none are exported)</i></span></span>

	<input type='checkbox' class="showhide" id="unexported-variables-showhide"><i><label for="unexported-variables-showhide" class="show-inline">/* 4 unexporteds ... */</label><label for="unexported-variables-showhide" class="hide-inline">/* 4 unexporteds: */</label></i><div class="anchor value-res hidden" id="name-bgTask"><i>	<span class="nodocs">  var <a href="../../src/runtime/trace/annotation.go.html#line-90">bgTask</a> <a href="#name-Task">Task</a></span></i></div><div class="anchor value-res hidden" id="name-lastTaskID"><i>	<span class="nodocs">  var <a href="../../src/runtime/trace/annotation.go.html#line-83">lastTaskID</a> <a href="../builtin.html#name-uint64">uint64</a> // task id issued last time</span></i></div><div class="anchor value-res hidden" id="name-noopRegion"><i>	<span class="nodocs">  var <a href="../../src/runtime/trace/annotation.go.html#line-168">noopRegion</a> *<a href="#name-Region">Region</a></span></i></div><div class="anchor value-res hidden" id="name-tracing"><i>	<span class="nodocs">  var <a href="../../src/runtime/trace/trace.go.html#line-150">tracing</a> struct{<a href="../sync.html">sync</a>.<a href="../sync.html#name-Mutex">Mutex</a>; enabled <a href="../builtin.html#name-int32">int32</a>}</span></i></div></div>
<div id="exported-constants"><span class="title">Package-Level Constants<span class="title-stat"><i> (total 2, neither is exported)</i></span></span>

	<input type='checkbox' class="showhide" id="unexported-constants-showhide"><i><label for="unexported-constants-showhide" class="show-inline">/* 2 unexporteds ... */</label><label for="unexported-constants-showhide" class="hide-inline">/* 2 unexporteds: */</label></i><div class="anchor value-res hidden" id="name-regionEndCode"><i>	<span class="nodocs">const <a href="../../src/runtime/trace/annotation.go.html#line-112">regionEndCode</a> <a href="../builtin.html#name-uint64">uint64</a> = 1</span></i></div><div class="anchor value-res hidden" id="name-regionStartCode"><i>	<span class="nodocs">const <a href="../../src/runtime/trace/annotation.go.html#line-111">regionStartCode</a> <a href="../builtin.html#name-uint64">uint64</a> = 0</span></i></div></div></code></pre><pre id="footer">
<table><tr><td><img src="../../png/go101-twitter.png"></td>
<td>The pages are generated with <a href="https://go101.org/article/tool-golds.html"><b>Golds</b></a> <i>v0.4.1</i>. (GOOS=linux GOARCH=amd64)
<b>Golds</b> is a <a href="https://go101.org">Go 101</a> project developed by <a href="https://tapirgames.com">Tapir Liu</a>.
PR and bug reports are welcome and can be submitted to <a href="https://github.com/go101/golds">the issue list</a>.
Please follow <a href="https://twitter.com/go100and1">@Go100and1</a> (reachable from the left QR code) to get the latest news of <b>Golds</b>.</td></tr></table></pre>